!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.G3D=t():e.G3D=t()}(window,function(){return function(r){var n={};function i(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return r[e].call(t.exports,t,t.exports,i),t.l=!0,t.exports}return i.m=r,i.c=n,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/",i(i.s=0)}([function(e,t,r){e.exports=r(1)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(2),i=r(13),o=r(17),a=r(4),u=r(30),s=r(31),f=r(32),l=r(33),c=r(41),d=r(42),h=r(22),p=r(25),v=r(43),g=r(44),m=r(45),y=r(19),_=r(21),T=r(24),E=r(46),b=r(35),x=r(28),M=r(47),P=r(51),R=r(52),w=r(36),O=r(48),C=r(37),S=r(55),A=r(14),L=r(15),U=r(71),N=r(16),V=r(66),I={Engine:n.default,GL:a.default,Env:{},Scene:o.default,Skybox:m.default,Buffer:u.default,BufferView:s.default,ElementBuffer:f.default,ElementBufferView:l.default,CubeTexture:c.default,Texture:d.default,Node:i.default,BaseOrthographicCamera:h.default,BasePerspectiveCamera:p.default,RotateOrthographicCamera:v.default,RotatePerspectiveCamera:g.default,AmbientLight:y.default,DirectionalLight:_.default,PointLight:T.default,LineMesh:E.default,Mesh:b.default,Geometry:x.default,LineGeometry:M.default,ShaderMaterial:C.default,PBREnviroment:P.default,PBRMaterial:R.default,PhongMaterial:w.default,RawMaterial:O.default,MeshBuilder:S.default,Mat4:A.default,Quat:L.default,Vec2:U.default,Vec3:N.default,Vec4:V.default};t.default=I},function(e,t,r){"use strict";var l=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var u=r(3),c=r(4),s=r(5),f=r(7),d=r(8),h=r(9),p=r(10),v=r(11),g=r(12),n=function(){function a(e){if(this.shaders=new Map,this.framebuffers={},this.pixelDataReaded=new Uint8Array(4),a.instance)throw new Error("Only 1 Engine instance is allowed.");a.instance=this,c.default.gl=e.getContext("webgl",{antialias:!0,preserveDrawingBuffer:!0});var t=c.default.gl;c.default.width=e.width,c.default.height=e.height;var r=c.default.extensions;r.set("TEX_LOD",t.getExtension("EXT_shader_texture_lod")),r.set("DER",t.getExtension("OES_standard_derivatives")),r.set("ELE_UNIT",t.getExtension("OES_element_index_uint")),r.set("SRGB",t.getExtension("EXT_SRGB"));var n=c.default.precisions,i=0!==t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision,o=0!==t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision;n.set("float",i?"mediump":o?"mediump":"lowp"),this.shaders.set("picker",new s.default({fShaderSource:f,vShaderSource:d})),this.shaders.set("shadow",new s.default({fShaderSource:h,vShaderSource:p})),this.shaders.set("skybox",new s.default({fShaderSource:v,vShaderSource:g})),this.framebuffers={picker:new u.default({width:c.default.width,height:c.default.height}),shadow:new u.default({width:1024,height:1024})},t.viewport(0,0,c.default.width,c.default.height),t.enable(t.DEPTH_TEST),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,1)}return a.prototype.destroy=function(){var t,e,r,n,i=c.default.buffers,o=c.default.textures;try{for(var a=l(i),u=a.next();!u.done;u=a.next()){u.value.destructor()}}catch(e){t={error:e}}finally{try{u&&!u.done&&(e=a.return)&&e.call(a)}finally{if(t)throw t.error}}i.clear();try{for(var s=l(o),f=s.next();!f.done;f=s.next()){f.value.destructor()}}catch(e){r={error:e}}finally{try{f&&!f.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}o.clear()},a.prototype.clearColorBuffer=function(e,t){void 0===t&&(t=1);var r=c.default.gl;r.clearColor(e.r/255,e.g/255,e.b/255,t),r.clear(r.COLOR_BUFFER_BIT)},a.prototype.clearDepthBuffer=function(){var e=c.default.gl;e.clear(e.DEPTH_BUFFER_BIT)},a.prototype.useBuiltinProgram=function(e,t){void 0===t&&(t=[]),this.currentProgram=this.shaders.get(e).program(t),c.default.gl.useProgram(this.currentProgram.glProgram)},a.prototype.useProgram=function(e){this.currentProgram=e,c.default.gl.useProgram(this.currentProgram.glProgram)},a.prototype.uniform=function(e,t){this.currentProgram.uniform(e,t)},a.prototype.attribute=function(e,t,r,n){this.currentProgram.attribute(e,t,r,n)},a.prototype.enableDepthMask=function(){c.default.gl.depthMask(!0)},a.prototype.disableDepthMask=function(){c.default.gl.depthMask(!1)},a.prototype.enableBlend=function(){var e=c.default.gl;e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA)},a.prototype.disableBlend=function(){var e=c.default.gl;e.disable(e.BLEND)},a.prototype.cullFace=function(e){var t=c.default.gl;e?(t.enable(t.CULL_FACE),t[e]&&t.cullFace(t[e])):t.disable(t.CULL_FACE)},a.prototype.bindFramebuffer=function(e){var t=c.default.gl,r=this.framebuffers[e];r?(t.bindFramebuffer(t.FRAMEBUFFER,r.framebuffer),t.viewport(0,0,r.width,r.height)):(t.bindFramebuffer(t.FRAMEBUFFER,null),t.viewport(0,0,c.default.width,c.default.height))},a.prototype.getFramebuffer=function(e){return this.framebuffers[e]},a.prototype.lineWidth=function(e){c.default.gl.lineWidth(e)},a.prototype.elements=function(e){var t=c.default.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e)},a.prototype.draw=function(e,t,r,n){c.default.gl.drawElements(e,t,r,n)},a.prototype.readFramebufferPixel=function(e,t,r){var n=this.pixelDataReaded,i=c.default.gl;if(this.framebuffers[e])return r=c.default.height-r,this.bindFramebuffer(e),i.readPixels(t,r,1,1,i.RGBA,i.UNSIGNED_BYTE,n),this.bindFramebuffer(null),[n[0],n[1],n[2],n[3]]},a.instance=null,a}();t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=r(4),n=function(){function e(e){var t=e.width,r=e.height,n=u.default.gl;this.width=t,this.height=r;var i=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,i);var o=n.createTexture();n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,o),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t,r,0,n.RGBA,n.UNSIGNED_BYTE,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,o,0);var a=n.createRenderbuffer();if(n.bindRenderbuffer(n.RENDERBUFFER,a),n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_COMPONENT16,t,r),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,a),n.checkFramebufferStatus(n.FRAMEBUFFER)!==n.FRAMEBUFFER_COMPLETE)throw new Error("framebuffer not ready "+n.checkFramebufferStatus(n.FRAMEBUFFER));n.bindFramebuffer(n.FRAMEBUFFER,null),this.framebuffer=i,this.colorTarget=o,this.depthTarget=a}return e.prototype.destructor=function(){var e=u.default.gl,t=this.framebuffer,r=this.colorTarget,n=this.depthTarget;e.deleteRenderbuffer(n),e.deleteTexture(r),e.deleteFramebuffer(t)},e}();t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={width:0,height:0,gl:null,extensions:new Map,precisions:new Map,buffers:new Set,textures:new Set};t.default=n},function(e,t,r){"use strict";var s=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}},n=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},i=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(n(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var f=r(4),o=r(6),a=function(){function e(e){var t,r,n=e.fShaderSource,i=e.vShaderSource;this.programs={},this.extensions=[],this.precisions=[],this.fShaderSource=n,this.vShaderSource=i;try{for(var o=s(f.default.extensions.keys()),a=o.next();!a.done;a=o.next()){var u=a.value;f.default.extensions.get(u)&&this.extensions.push("EXT_"+u)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}this.precisions.push("PRECISION_FLOAT_"+f.default.precisions.get("float").toUpperCase())}return e.prototype.program=function(e){var t=(e=e.sort()).join(";");if(!this.programs[t]){var r=i(this.precisions,this.extensions,e).map(function(e){return"#define "+e+" 1"}).join("\n")+"\n";this.programs[t]=new o.default({vShaderSource:r+this.vShaderSource,fShaderSource:r+this.fShaderSource})}return this.programs[t]},e.prototype.destructor=function(){for(var e in this.programs)this.programs[e].destructor()},e}();t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var _=r(4),n=function(){function e(e){var t=e.fShaderSource,r=e.vShaderSource;this.textureCount=0,this.fShaderSource=t,this.vShaderSource=r,this.initProgram()}return e.prototype.destructor=function(){_.default.gl.deleteProgram(this.glProgram)},e.prototype.uniform=function(e,t){if(this.uniforms[e]){var r=_.default.gl,n=this.uniforms[e],i=n.type,o=(n.info,n.position),a=n.unit,u=this.parseType(i),s=u.baseType,f=(u.vecType,u.baseVecType),l=u.vecSize;switch(f){case"VEC":r[["uniform",l,"FLOAT"===s?"f":"i","v"].join("")](o,t);break;case"MAT":r[["uniform","Matrix",l,"fv"].join("")](o,!1,t);break;case"2D":r.activeTexture(r["TEXTURE"+a]),r.bindTexture(r.TEXTURE_2D,t),r.uniform1i(o,a);break;case"CUB":r.activeTexture(r["TEXTURE"+a]),r.bindTexture(r.TEXTURE_CUBE_MAP,t),r.uniform1i(o,a);break;default:throw new Error("baseVecType invalid "+f)}}},e.prototype.attribute=function(e,t,r,n){if(this.attributes[e]){var i=_.default.gl,o=this.attributes[e],a=o.type,u=(o.info,o.position),s=this.parseType(a),f=s.baseType,l=(s.vecType,s.baseVecType,s.vecSize);i.bindBuffer(i.ARRAY_BUFFER,t),i.vertexAttribPointer(u,l,i[f],!1,r,n),i.enableVertexAttribArray(u)}},e.prototype.initProgram=function(){var n=_.default.gl,e=this.fShaderSource,t=this.vShaderSource;function r(e,t){var r=n.createShader(e);if(n.shaderSource(r,t),n.compileShader(r),!n.getShaderParameter(r,n.COMPILE_STATUS))throw new Error("An error occurred compiling the shaders: "+n.getShaderInfoLog(r));return r}function i(e){for(var t=["FLOAT","FLOAT_VEC2","FLOAT_VEC3","FLOAT_VEC4","FLOAT_MAT2","FLOAT_MAT3","FLOAT_MAT4","INT","INT_VEC2","INT_VEC3","INT_VEC4","BOOL","BOOL_VEC2","BOOL_VEC3","BOOL_VEC4","SAMPLER_2D","SAMPLER_CUBE"],r=0;r<t.length;r++)if(n[t[r]]===e)return t[r];throw new Error("get type failed ' + value")}var o=r(n.FRAGMENT_SHADER,e),a=r(n.VERTEX_SHADER,t),u=n.createProgram();if(n.attachShader(u,a),n.attachShader(u,o),n.linkProgram(u),!n.getProgramParameter(u,n.LINK_STATUS))throw new Error("Unable to initialize the shader program: "+n.getProgramInfoLog(u));for(var s={},f={},l=n.getProgramParameter(u,n.ACTIVE_ATTRIBUTES),c=0;c<l;c++){var d=n.getActiveAttrib(u,c),h={type:i(d.type),info:d,position:n.getAttribLocation(u,d.name)};f[d.name]=h}var p=n.getProgramParameter(u,n.ACTIVE_UNIFORMS);for(c=0;c<p;c++){var v=n.getActiveUniform(u,c),g=(h={type:i(v.type),info:v,position:n.getUniformLocation(u,v.name),unit:void 0},this.parseType(h.type).baseVecType);if("2D"===g){var m=++this.textureCount;h.unit=m}if("CUB"===g){m=++this.textureCount;h.unit=m}var y=v.name;-1!==y.indexOf("[0]")&&(y=y.replace("[0]","")),s[y]=h}this.glProgram=u,this.attributes=f,this.uniforms=s},e.prototype.parseType=function(e){var t=e.split("_")[0],r=1<e.split("_").length?e.split("_")[1]:"VEC1",n=r.substr(0,3);return{baseType:t,vecType:r,baseVecType:n,vecSize:Number(r[3])}},e}();t.default=n},function(e,t){e.exports="#ifdef GL_ES\nprecision mediump float;\n#endif\n\nuniform int meshId;\nvoid main() {\n    float n = float(meshId);\n    float n1 = fract(n / 16.0);\n    n = n / 16.0 - n1;\n    float n2 = fract(n / 16.0);\n    n = n / 16.0 - n2;\n    float n3 = fract(n / 16.0);\n    n = n / 16.0 - n3;\n    float n4 = fract(n / 16.0);\n    gl_FragColor = vec4(n1, n2, n3, n4);\n}\n"},function(e,t){e.exports="attribute vec3 aPosition;\n\nuniform mat4 uPMatrix;\nuniform mat4 uVMatrix;\nuniform mat4 uMMatrix;\n\nvoid main() {\n\n    vec3 position = aPosition;\n\n    gl_Position = uPMatrix * uVMatrix * uMMatrix * vec4(position, 1.0);\n}\n"},function(e,t){e.exports="#ifdef GL_ES\nprecision mediump float;\n#endif\n\nvoid main() {\n    gl_FragColor = vec4(gl_FragCoord.z, 0.0, 0.0, 1.0);\n}\n"},function(e,t){e.exports="attribute vec3 aPosition;\n\nuniform mat4 uPMatrix;\nuniform mat4 uVMatrix;\nuniform mat4 uMMatrix;\n\nvoid main() {\n\n    vec3 position = aPosition;\n\n    gl_Position = uPMatrix * uVMatrix * uMMatrix * vec4(position, 1.0);\n}\n"},function(e,t){e.exports="precision highp float;\n\nuniform samplerCube uCubeTexture;\n\nvarying vec3 vUV;\n\nvoid main() {\n    gl_FragColor = textureCube(uCubeTexture, normalize(vUV));\n}\n"},function(e,t){e.exports="precision highp float;\n\nattribute vec3 aPosition;\n\nuniform mat4 uVMatrix;\nuniform mat4 uPMatrix;\n\nvarying vec3 vUV;\n\nvoid main()\n{\n    gl_Position = uPMatrix * uVMatrix * vec4(aPosition, 1.0);\n    vUV = aPosition;\n}\n"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(14),i=r(15),o=r(16),a=1,u=function(){function e(){this.id=a++,this.position={x:0,y:0,z:0},this.rotation={x:0,y:0,z:0},this.scale={x:1,y:1,z:1},this.parent=null,this.positionValues=o.default.create(),this.quatValues=i.default.create(),this.scaleValues=o.default.create(),this.matrixValues=n.default.create(),this.worldMatrixValues=n.default.create()}return e.prototype.getMatrix=function(){return o.default.set(this.positionValues,this.position.x,this.position.y,this.position.z),i.default.fromEuler(this.quatValues,this.rotation.x,this.rotation.y,this.rotation.z),o.default.set(this.scaleValues,this.scale.x,this.scale.y,this.scale.z),n.default.fromRotationTranslationScale(this.matrixValues,this.quatValues,this.positionValues,this.scaleValues),this.matrixValues},e.prototype.getWorldMatrix=function(){return this.getMatrix(),this.parent?n.default.multiply(this.worldMatrixValues,this.parent.getWorldMatrix(),this.matrixValues):n.default.copy(this.worldMatrixValues,this.matrixValues),this.worldMatrixValues},e}();t.default=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={create:function(){var e=new Float32Array(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromValues:function(e,t,r,n,i,o,a,u,s,f,l,c,d,h,p,v){var g=new Float32Array(16);return g[0]=e,g[1]=t,g[2]=r,g[3]=n,g[4]=i,g[5]=o,g[6]=a,g[7]=u,g[8]=s,g[9]=f,g[10]=l,g[11]=c,g[12]=d,g[13]=h,g[14]=p,g[15]=v,g},set:function(e,t,r,n,i,o,a,u,s,f,l,c,d,h,p,v,g){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=o,e[5]=a,e[6]=u,e[7]=s,e[8]=f,e[9]=l,e[10]=c,e[11]=d,e[12]=h,e[13]=p,e[14]=v,e[15]=g,e},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},transpose:function(e,t){if(e===t){var r=t[1],n=t[2],i=t[3],o=t[6],a=t[7],u=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=o,e[11]=t[14],e[12]=i,e[13]=a,e[14]=u}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},multiply:function(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],u=t[4],s=t[5],f=t[6],l=t[7],c=t[8],d=t[9],h=t[10],p=t[11],v=t[12],g=t[13],m=t[14],y=t[15],_=r[0],T=r[1],E=r[2],b=r[3];return e[0]=_*n+T*u+E*c+b*v,e[1]=_*i+T*s+E*d+b*g,e[2]=_*o+T*f+E*h+b*m,e[3]=_*a+T*l+E*p+b*y,_=r[4],T=r[5],E=r[6],b=r[7],e[4]=_*n+T*u+E*c+b*v,e[5]=_*i+T*s+E*d+b*g,e[6]=_*o+T*f+E*h+b*m,e[7]=_*a+T*l+E*p+b*y,_=r[8],T=r[9],E=r[10],b=r[11],e[8]=_*n+T*u+E*c+b*v,e[9]=_*i+T*s+E*d+b*g,e[10]=_*o+T*f+E*h+b*m,e[11]=_*a+T*l+E*p+b*y,_=r[12],T=r[13],E=r[14],b=r[15],e[12]=_*n+T*u+E*c+b*v,e[13]=_*i+T*s+E*d+b*g,e[14]=_*o+T*f+E*h+b*m,e[15]=_*a+T*l+E*p+b*y,e},invert:function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],u=t[5],s=t[6],f=t[7],l=t[8],c=t[9],d=t[10],h=t[11],p=t[12],v=t[13],g=t[14],m=t[15],y=r*u-n*a,_=r*s-i*a,T=r*f-o*a,E=n*s-i*u,b=n*f-o*u,x=i*f-o*s,M=l*v-c*p,P=l*g-d*p,R=l*m-h*p,w=c*g-d*v,O=c*m-h*v,C=d*m-h*g,S=y*C-_*O+T*w+E*R-b*P+x*M;return S?(S=1/S,e[0]=(u*C-s*O+f*w)*S,e[1]=(i*O-n*C-o*w)*S,e[2]=(v*x-g*b+m*E)*S,e[3]=(d*b-c*x-h*E)*S,e[4]=(s*R-a*C-f*P)*S,e[5]=(r*C-i*R+o*P)*S,e[6]=(g*T-p*x-m*_)*S,e[7]=(l*x-d*T+h*_)*S,e[8]=(a*O-u*R+f*M)*S,e[9]=(n*R-r*O-o*M)*S,e[10]=(p*b-v*T+m*y)*S,e[11]=(c*T-l*b-h*y)*S,e[12]=(u*P-a*w-s*M)*S,e[13]=(r*w-n*P+i*M)*S,e[14]=(v*_-p*E-g*y)*S,e[15]=(l*E-c*_+d*y)*S,e):null},fromRotationTranslationScale:function(e,t,r,n){var i=t[0],o=t[1],a=t[2],u=t[3],s=i+i,f=o+o,l=a+a,c=i*s,d=i*f,h=i*l,p=o*f,v=o*l,g=a*l,m=u*s,y=u*f,_=u*l,T=n[0],E=n[1],b=n[2];return e[0]=(1-(p+g))*T,e[1]=(d+_)*T,e[2]=(h-y)*T,e[3]=0,e[4]=(d-_)*E,e[5]=(1-(c+g))*E,e[6]=(v+m)*E,e[7]=0,e[8]=(h+y)*b,e[9]=(v-m)*b,e[10]=(1-(c+p))*b,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e},getTranslation:function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},getScaling:function(e,t){var r=t[0],n=t[1],i=t[2],o=t[4],a=t[5],u=t[6],s=t[8],f=t[9],l=t[10];return e[0]=Math.sqrt(r*r+n*n+i*i),e[1]=Math.sqrt(o*o+a*a+u*u),e[2]=Math.sqrt(s*s+f*f+l*l),e},getRotation:function(e,t){var r=t[0]+t[5]+t[10],n=0;return 0<r?(n=2*Math.sqrt(r+1),e[3]=.25*n,e[0]=(t[6]-t[9])/n,e[1]=(t[8]-t[2])/n,e[2]=(t[1]-t[4])/n):t[0]>t[5]&&t[0]>t[10]?(n=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/n,e[0]=.25*n,e[1]=(t[1]+t[4])/n,e[2]=(t[8]+t[2])/n):t[5]>t[10]?(n=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/n,e[0]=(t[1]+t[4])/n,e[1]=.25*n,e[2]=(t[6]+t[9])/n):(n=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/n,e[0]=(t[8]+t[2])/n,e[1]=(t[6]+t[9])/n,e[2]=.25*n),e},perspective:function(e,t,r,n,i){var o=1/Math.tan(t/2),a=1/(n-i);return e[0]=o/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(i+n)*a,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*i*n*a,e[15]=0,e},ortho:function(e,t,r,n,i,o,a){var u=1/(t-r),s=1/(n-i),f=1/(o-a);return e[0]=-2*u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*f,e[11]=0,e[12]=(t+r)*u,e[13]=(i+n)*s,e[14]=(a+o)*f,e[15]=1,e},lookAt:function(e,t,r,n){var i,o,a,u,s,f,l,c,d,h,p,v=t[0],g=t[1],m=t[2],y=n[0],_=n[1],T=n[2],E=r[0],b=r[1],x=r[2];return Math.abs(v-E)<1e-6&&Math.abs(g-b)<1e-6&&Math.abs(m-x)<1e-6?((p=e)[0]=1,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=1,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=1,p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p):(l=v-E,c=g-b,d=m-x,i=_*(d*=h=1/Math.sqrt(l*l+c*c+d*d))-T*(c*=h),o=T*(l*=h)-y*d,a=y*c-_*l,(h=Math.sqrt(i*i+o*o+a*a))?(i*=h=1/h,o*=h,a*=h):a=o=i=0,u=c*a-d*o,s=d*i-l*a,f=l*o-c*i,(h=Math.sqrt(u*u+s*s+f*f))?(u*=h=1/h,s*=h,f*=h):f=s=u=0,e[0]=i,e[1]=u,e[2]=l,e[3]=0,e[4]=o,e[5]=s,e[6]=c,e[7]=0,e[8]=a,e[9]=f,e[10]=d,e[11]=0,e[12]=-(i*v+o*g+a*m),e[13]=-(u*v+s*g+f*m),e[14]=-(l*v+c*g+d*m),e[15]=1,e)}};t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={create:function(){var e=new Float32Array(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},setAxisAngle:function(e,t,r){r*=.5;var n=Math.sin(r);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(r),e},getAxisAngle:function(e,t){var r=2*Math.acos(t[3]),n=Math.sin(r/2);return e[2]=0!==n?(e[0]=t[0]/n,e[1]=t[1]/n,t[2]/n):(e[0]=1,e[1]=0),r},fromEuler:function(e,t,r,n){var i=.5*Math.PI/180;t*=i,r*=i,n*=i;var o=Math.sin(t),a=Math.cos(t),u=Math.sin(r),s=Math.cos(r),f=Math.sin(n),l=Math.cos(n);return e[0]=o*s*l-a*u*f,e[1]=a*u*l+o*s*f,e[2]=a*s*f-o*u*l,e[3]=a*s*l+o*u*f,e},getEuler:function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3];return e[0]=180*Math.atan2(2*(o*r+i*n),1-2*(n*n+r*r))/Math.PI,e[1]=180*Math.asin(2*(o*n-r*i))/Math.PI,e[2]=180*Math.atan2(2*(o*i+n*r),1-2*(i*i+n*n))/Math.PI,e}};t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={create:function(){var e=new Float32Array(3);return e[0]=0,e[1]=0,e[2]=0,e},fromValues:function(e,t,r){var n=new Float32Array(3);return n[0]=e,n[1]=t,n[2]=r,n},set:function(e,t,r,n){return e[0]=t,e[1]=r,e[2]=n,e},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e},subtract:function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e},multiply:function(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e},divide:function(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e},scale:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e},length:function(e){var t=e[0],r=e[1],n=e[2];return Math.sqrt(t*t+r*r+n*n)},distance:function(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(r*r+n*n+i*i)},negate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},normalize:function(e,t){var r=t[0],n=t[1],i=t[2],o=r*r+n*n+i*i;return 0<o&&(o=1/Math.sqrt(o),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o),e},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},cross:function(e,t,r){var n=t[0],i=t[1],o=t[2],a=r[0],u=r[1],s=r[2];return e[0]=i*s-o*u,e[1]=o*a-n*s,e[2]=n*u-i*a,e},transformMat4:function(e,t,r){var n=t[0],i=t[1],o=t[2],a=r[3]*n+r[7]*i+r[11]*o+r[15];return a=a||1,e[0]=(r[0]*n+r[4]*i+r[8]*o+r[12])/a,e[1]=(r[1]*n+r[5]*i+r[9]*o+r[13])/a,e[2]=(r[2]*n+r[6]*i+r[10]*o+r[14])/a,e}};t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(18),i=function(){function e(e){this.clearColor={r:51,g:51,b:76},this.renderManager=new n.default(this),this.meshes=[],this.lights=[],this.engine=e,this.engine.currentScene=this}return e.prototype.render=function(){this.renderManager.render()},e.prototype.pick=function(e,t){var r=this.engine.readFramebufferPixel("picker",e,t);return[r[0],r[1],r[2],r[3]].map(function(e){return Math.round(e/16)}).reduceRight(function(e,t){return 16*e+t},0)},e}();t.default=i},function(e,t,r){"use strict";var f=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var h=r(2),m=r(4),p=r(19),v=r(21),g=r(24),y=r(28),s=r(34),_=r(35),a=r(31),n=function(){function e(e){this.scene=null,this.lights={type:[],color:new Float32Array(48),intensity:new Float32Array(16),position:new Float32Array(48)},this.groups=[],this.scene=e}return e.prototype.render=function(){var e=this.scene,t=h.default.instance;e.activeCamera&&(this.groupMeshLayers(),t.bindFramebuffer("picker"),this.renderToPickerRenderBuffer(),t.bindFramebuffer(null),t.bindFramebuffer("shadow"),this.renderToShadowRenderBuffer(),t.bindFramebuffer(null),this.renderToScreen())},e.prototype.groupMeshLayers=function(){var t,e,r=this.scene.meshes;this.groups=[];try{for(var n=f(r),i=n.next();!i.done;i=n.next()){var o=i.value,a=o.getRenderLayerIndex();this.groups[a]||(this.groups[a]=[]),this.groups[a].push(o)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}},e.prototype.getShadowLight=function(){for(var e=this.scene.lights,t=0;t<e.length;t++){var r=e[t];if((r instanceof v.default||r instanceof g.default)&&r.castShadow)return r}return null},e.prototype.renderToScreen=function(){var p=this,e=this.scene,t=this.groups,v=h.default.instance;v.clearColorBuffer(e.clearColor),e.skybox&&(v.clearDepthBuffer(),this.drawSkybox());var g=[];this.getShadowLight()&&g.push("CAST_SHADOW"),t.forEach(function(e){v.clearDepthBuffer(),e.filter(function(e){return e.getGlobalVisibility()}).forEach(function(h){h.geometry.bufferViews.indices&&Object.keys(h.geometry.bufferViews.indices).forEach(function(e){var t=h.materials[e];v.useProgram(t.getProgram(g)),p.prepareMVPMatrix(h),p.prepareGeometry(h.geometry),p.prepareMaterial(t),t.lighting&&p.prepareLights(),t.shadow&&p.prepareShadow(),t.camera&&p.prepareCameraPosition();var r=t.passes;for(var n in r){var i=r[n],o=i.uniforms,a=i.depthTest,u=i.cullFace,s=i.blend;for(var f in o){var l=o[f],c=l.name,d=l.value;v.uniform(c,d)}a?v.enableDepthMask():v.disableDepthMask(),s?(v.enableBlend(),m.default.gl.blendFunc(m.default.gl.ONE,m.default.gl.ONE)):v.disableBlend(),h instanceof _.default&&(u?p.setFaceCull(h.geometry.facing):p.setFaceCull(h.geometry.facing===y.default.FACING.FRONT?y.default.FACING.BACK:y.default.FACING.FRONT)),p.drawMesh(h,e)}})})})},e.prototype.renderToPickerRenderBuffer=function(){var r=this,e=this.groups,n=h.default.instance;n.clearColorBuffer({r:0,g:0,b:0},0),e.forEach(function(e){n.clearDepthBuffer(),e.filter(function(e){return e.getPickable()&&e.getGlobalVisibility()}).forEach(function(t){Object.keys(t.materials).forEach(function(e){t.materials[e]&&(n.useBuiltinProgram("picker"),r.prepareMVPMatrix(t),r.prepareGeometry(t.geometry),n.uniform("meshId",[t.id]),r.drawMesh(t,e))})})})},e.prototype.renderToShadowRenderBuffer=function(){var r=this,e=this.scene,t=this.groups,n=e.lights,i=h.default.instance,o=s.find(n,function(e){return e.castShadow});if(o){var a=t[0];i.clearColorBuffer({r:0,g:0,b:0}),i.clearDepthBuffer();var u=o.getShadowCamera();a.forEach(function(t){Object.keys(t.geometry.bufferViews.indices).forEach(function(e){t.materials[e]&&(i.useBuiltinProgram("shadow"),r.prepareMVPMatrix(t,u),r.prepareGeometry(t.geometry),r.drawMesh(t,e))})})}},e.prototype.setFaceCull=function(e){h.default.instance.cullFace(e===y.default.FACING.FRONT?"BACK":e===y.default.FACING.BACK?"FRONT":null)},e.prototype.prepareMVPMatrix=function(e,t){void 0===t&&(t=this.scene.activeCamera);var r=h.default.instance;r.uniform("uVMatrix",t.getVMatrix()),r.uniform("uPMatrix",t.getPMatrix()),r.uniform("uMMatrix",e.getWorldMatrix())},e.prototype.prepareLights=function(){var e=this.scene,t=h.default.instance,r=e.lights,n=this.lights,i=n.type,o=n.color,a=n.intensity,u=n.position;if(16<r.length)throw new Error("[G3D] Scene could not have more than 16 lights.");for(var s=0;s<16;s++){var f=r[s],l=f?f.getColor().map(function(e){return e/255}):[0,0,0],c=f?f.getIntensity():0,d=void 0;d=f instanceof v.default?(i[s]=3,f.getDirection()):f instanceof p.default?(i[s]=2,[0,0,0]):f instanceof g.default?(i[s]=4,f.getPosition()):(i[s]=1,[0,0,0]),o[3*s]=l[0],o[3*s+1]=l[1],o[3*s+2]=l[2],a[s]=c,u[3*s]=d[0],u[3*s+1]=d[1],u[3*s+2]=d[2]}t.uniform("uLightType",i),t.uniform("uLightColor",o),t.uniform("uLightIntensity",a),t.uniform("uLightPosition",u)},e.prototype.prepareGeometry=function(e){var t=h.default.instance,r=e.bufferViews,n=r.vertices,i=r.uvs,o=r.normals;n&&(t.attribute("aPosition",n.buffer.glBuffer,n.byteStride,n.byteOffset),i&&(i instanceof a.default?t.attribute("aUV",i.buffer.glBuffer,i.byteStride,i.byteOffset):Object.keys(i).forEach(function(e){t.attribute(e,i[e].buffer.glBuffer,i[e].byteStride,i[e].byteOffset)})),o&&t.attribute("aNormal",o.buffer.glBuffer,o.byteStride,o.byteOffset))},e.prototype.prepareMaterial=function(e){var t,r,n=h.default.instance,i=e.uniforms;try{for(var o=f(i),a=o.next();!a.done;a=o.next()){var u=a.value,s=e.uniform(u);null!==s&&n.uniform(u,s)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}},e.prototype.prepareCameraPosition=function(){var e=h.default.instance,t=this.scene.activeCamera;e.uniform("uCameraPosition",t.getPosition())},e.prototype.prepareShadow=function(){var e=h.default.instance,t=this.getShadowLight();if(t){var r=e.getFramebuffer("shadow").colorTarget;e.uniform("uShadowMapTexture",r);var n=t.getShadowCamera();e.uniform("uShadowVMatrix",n.getVMatrix()),e.uniform("uShadowPMatrix",n.getPMatrix())}},e.prototype.drawMesh=function(e,t){var r=h.default.instance,n=e.geometry.bufferViews.indices;n&&n[t]&&(r.elements(n[t].buffer.glBuffer),r.draw(n[t].mode,n[t].count,n[t].type,n[t].byteOffset))},e.prototype.drawSkybox=function(){var e=h.default.instance,t=this.scene,r=t.skybox,n=t.activeCamera;e.useBuiltinProgram("skybox"),this.setFaceCull(r.geometry.facing);var i=r.geometry.bufferViews,o=i.vertices,a=i.indices;for(var u in e.attribute("aPosition",o.buffer.glBuffer,o.byteStride,o.byteOffset),e.uniform("uVMatrix",n.getVMatrix()),e.uniform("uPMatrix",n.getPMatrix()),e.uniform("uCubeTexture",r.cubeTexture.glTexture),a)e.elements(a[u].buffer.glBuffer),e.draw(a[u].mode,a[u].count,a[u].type,a[u].byteOffset)},e}();t.default=n},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(r(20).default);t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.color={r:255,g:255,b:255},this.intensity=1,this.colorValues=[255,255,255],(this.scene=e).lights.push(this)}return e.prototype.getColor=function(){return this.colorValues[0]=this.color.r,this.colorValues[1]=this.color.g,this.colorValues[2]=this.color.b,this.colorValues},e.prototype.getIntensity=function(){return this.intensity},e}();t.default=n},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var a=r(20),u=r(22),s=function(r){function e(e){var t=r.call(this,e)||this;return t.direction={x:0,y:0,z:-1},t.castShadow=!1,t.shadowCamera=new u.default,t.directionValues=[0,0,-1],t}return i(e,r),e.prototype.getDirection=function(){return this.directionValues[0]=this.direction.x,this.directionValues[1]=this.direction.y,this.directionValues[2]=this.direction.z,this.directionValues},e.prototype.getShadowCamera=function(){var e=this.shadowCamera,t=this.scene.activeCamera.center,r=this.direction;return e.center=o({},t),e.position=o({},r),e.width=5,e.near=5,e.far=15,e},e}(a.default);t.default=s},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(14),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.width=10,e.viewRatio=1,e.near=1,e.far=1e3,e.projectMatrixValues=o.default.create(),e}return i(e,t),e.prototype.getPMatrix=function(){var e=this.width,t=e/this.viewRatio;return o.default.ortho(this.projectMatrixValues,-e/2,e/2,-t/2,t/2,this.near,this.far),this.projectMatrixValues},e}(r(23).default);t.default=a},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(13),a=r(14),u=r(16),s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.center={x:0,y:0,z:0},e.up={x:0,y:1,z:0},e.cameraPositionValues=u.default.create(),e.centerValues=u.default.create(),e.upValues=u.default.create(),e.viewMatrixValues=a.default.create(),e}return i(e,t),e.prototype.getPMatrix=function(){return a.default.create()},e.prototype.getVMatrix=function(){return u.default.set(this.cameraPositionValues,this.position.x,this.position.y,this.position.z),u.default.set(this.centerValues,this.center.x,this.center.y,this.center.z),u.default.set(this.upValues,this.up.x,this.up.y,this.up.z),a.default.lookAt(this.viewMatrixValues,this.cameraPositionValues,this.centerValues,this.upValues),this.viewMatrixValues},e.prototype.getPosition=function(){return[this.position.x,this.position.y,this.position.z]},e}(o.default);t.default=s},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var a=r(25),u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.position={x:0,y:0,z:0},e.radius=1,e.castShadow=!1,e.castShadowFov=10,e.shadowCamera=new a.default,e.positionValues=[0,0,0],e}return i(e,t),e.prototype.getPosition=function(){return this.positionValues[0]=this.position.x,this.positionValues[1]=this.position.y,this.positionValues[2]=this.position.z,this.positionValues},e.prototype.getIntensity=function(){return t.prototype.getIntensity.call(this)*this.radius*this.radius},e.prototype.getShadowCamera=function(){var e=this.shadowCamera,t=this.scene.activeCamera.center,r=this.position;return e.center=o({},t),e.position=o({},r),e.fov=this.castShadowFov,e.near=7,e.far=120,e},e}(r(20).default);t.default=u},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(23),f=r(14),l=r(16),a=r(26),c=r(27),u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.fov=60,e.viewRatio=1,e.near=1,e.far=1e3,e.projectMatrixValues=f.default.create(),e}return i(e,t),e.prototype.getPMatrix=function(){return f.default.perspective(this.projectMatrixValues,a.deg2rad(this.fov),this.viewRatio,this.near,this.far),this.projectMatrixValues},e.prototype.getViewRay=function(e,t,r){void 0===r&&(r=!0),r&&(t=1-t);var n=2*(e-.5),i=2*(t-.5),o=this.getPMatrix(),a=l.default.fromValues(n,i,1);l.default.transformMat4(a,a,f.default.invert(f.default.create(),o)),l.default.transformMat4(a,a,f.default.invert(f.default.create(),this.getVMatrix()));var u=l.default.subtract(l.default.create(),a,l.default.fromValues(this.position.x,this.position.y,this.position.z)),s=new c.default;return s.origin.x=this.position.x,s.origin.y=this.position.y,s.origin.z=this.position.z,s.direction.x=u[0],s.direction.y=u[1],s.direction.z=u[2],s},e}(o.default);t.default=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.rad2deg=function(e){return 180*e/Math.PI},t.deg2rad=function(e){return e*Math.PI/180},t.isPowerOf2=function(e){return 1<=e&&Math.log2(e)%1==0}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=r(16),n=function(){function e(){this.origin={x:0,y:0,z:0},this.direction={x:0,y:0,z:1}}return e.prototype.intersectPlane=function(e){var t=e.normal,r=e.offset,n=this.distanceToPlane({normal:t,offset:r});if(null===n)return null;var i=s.default.fromValues(this.origin.x,this.origin.y,this.origin.z),o=s.default.normalize(s.default.create(),s.default.fromValues(this.direction.x,this.direction.y,this.direction.z)),a=s.default.scale(s.default.create(),o,n),u=s.default.add(s.default.create(),i,a);return{x:u[0],y:u[1],z:u[2]}},e.prototype.distanceToPlane=function(e){var t=e.normal,r=e.offset;t=s.default.normalize(s.default.create(),s.default.fromValues(t.x,t.y,t.z));var n=s.default.fromValues(this.origin.x,this.origin.y,this.origin.z),i=s.default.normalize(s.default.create(),s.default.fromValues(this.direction.x,this.direction.y,this.direction.z)),o=s.default.dot(t,i);if(0===o)return null;var a=-(s.default.dot(n,t)-r)/o;return 0<a?a:null},e}();t.default=n},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o,a,u=r(29);(a=o||(o={}))[a.FRONT=0]="FRONT",a[a.BACK=1]="BACK",a[a.BOTH=2]="BOTH";var s=function(c){function d(e){var t=void 0===e?{}:e,r=t.vertices,n=t.normals,i=t.uvs,o=t.indices,a=t.mergeNormals,u=void 0!==a&&a,s=t.facing,f=void 0===s?d.FACING.FRONT:s,l=c.call(this)||this;return u&&Array.isArray(r)&&Array.isArray(n)&&(n=l.mergeNormals(r,n)),l.facing=f,r&&(l.bufferViews={vertices:l.createBufferView(r),normals:n?l.createBufferView(n):null,uvs:i?l.createBufferView(i):null,indices:l.createElementBufferView(o)}),l}return i(d,c),d.prototype.mergeNormals=function(e,t){for(var r={},n=0;n<e.length;n+=3){r[o=[e[n],e[n+1],e[n+2]].join(",")]||(r[o]={indices:[],normal:[0,0,0]});var i=r[o];i.indices.push(n/3),i.normal[0]+=t[n],i.normal[1]+=t[n+1],i.normal[2]+=t[n+2]}for(var o in r){var a=r[o],u=a.indices,s=a.normal;for(n=0;n<u.length;n++){var f=u[n];t[3*f]=s[0]/u.length,t[3*f+1]=s[1]/u.length,t[3*f+2]=s[2]/u.length}}return t},d.FACING=o,d}(u.default);t.default=s},function(e,t,r){"use strict";var R=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a};Object.defineProperty(t,"__esModule",{value:!0});var n=r(30),i=r(31),s=r(32),f=r(33),w=r(4),o=function(){function e(){this.bufferViews={}}return e.prototype.getBoundingBox=function(){var e,t,r,n,i=R([void 0,void 0,void 0,void 0,void 0,void 0],6),o=i[0],a=i[1],u=i[2],s=i[3],f=i[4],l=i[5],c=w.default.gl,d=this.bufferViews,h=d.indices,p=d.vertices,v=p.byteOffset/4,g=0===p.byteStride?3:p.byteStride/4;for(var m in h)for(var y=h[m],_=y.count,T=y.type===c.UNSIGNED_INT?4:2,E=y.byteOffset/T,b=y.type===c.UNSIGNED_INT?new Uint32Array(y.buffer.arrayBuffer):new Uint16Array(y.buffer.arrayBuffer),x=new Float32Array(p.buffer.arrayBuffer),M=0;M<_;M++){var P=b[M+E]*g+v;e=x[P],t=x[P+1],r=x[P+2],(n=void 0)===o&&(n=R([e,e,t,t,r,r],6),o=n[0],a=n[1],u=n[2],s=n[3],f=n[4],l=n[5]),e<o&&(o=e),a<e&&(a=e),t<u&&(u=t),s<t&&(s=t),r<f&&(f=r),l<r&&(l=r)}return[o,a,u,s,f,l]},e.prototype.createBufferView=function(e){if(Array.isArray(e))return new i.default({buffer:new n.default({data:new Float32Array(e)})});if(e instanceof i.default)return e;var t={};for(var r in e)t[r]=this.createBufferView(e[r]);return t},e.prototype.createElementBufferView=function(e,t){void 0===t&&(t=!1);var r=w.default.extensions,n=R(r.get("ELE_UNIT")?[Uint32Array,"UNSIGNED_INT"]:[Uint16Array,"UNSIGNED_SHORT"],2),i=n[0],o=n[1],a={};for(var u in e)a[u]=Array.isArray(e[u])?new f.default({buffer:new s.default({data:new i(e[u])}),mode:t?"LINES":"TRIANGLES",count:e[u].length,type:o,byteOffset:0}):e[u];return a},e}();t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(4),n=function(){function e(e){var t=e.data,r=i.default.gl,n=i.default.buffers;this.glBuffer=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,this.glBuffer),r.bufferData(r.ARRAY_BUFFER,t,r.STATIC_DRAW),r.bindBuffer(r.ARRAY_BUFFER,null),t instanceof Float32Array?this.arrayBuffer=t.buffer:t instanceof ArrayBuffer&&(this.arrayBuffer=t),n.add(this)}return e.prototype.destructor=function(){var e=i.default.gl;i.default.buffers.delete(this),e.deleteBuffer(this.glBuffer)},e}();t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){var t=e.buffer,r=e.byteStride,n=void 0===r?0:r,i=e.byteOffset,o=void 0===i?0:i;this.buffer=t,this.byteStride=n,this.byteOffset=o};t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r(4),n=function(){function e(e){var t=e.data;this.u32=!1;var r=o.default.gl,n=o.default.buffers,i=o.default.extensions;if(this.glBuffer=r.createBuffer(),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,this.glBuffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,t,r.STATIC_DRAW),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,null),t instanceof Uint32Array||t instanceof Uint16Array){if(t instanceof Uint32Array){if(!i.get("ELE_UNIT"))throw new Error("Element index unit extension not supported, can not use Uint32Array for element buffer.");this.u32=!0}this.arrayBuffer=t.buffer}else t instanceof ArrayBuffer&&(this.arrayBuffer=t);n.add(this)}return e.prototype.destructor=function(){var e=o.default.gl;o.default.buffers.delete(this),e.deleteBuffer(this.glBuffer)},e}();t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=r(4),n=function(e){var t=e.buffer,r=e.mode,n=void 0===r?"TRIANGLES":r,i=e.count,o=void 0===i?0:i,a=e.type,u=void 0===a?t.u32?"UNSIGNED_INT":"UNSIGNED_SHORT":a,s=e.byteOffset,f=void 0===s?0:s,l=c.default.gl;this.buffer=t,this.mode="string"==typeof n?l[n]:n,this.type="string"==typeof u?l[u]:u,this.count=o,this.byteOffset=f};t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return"function"==typeof e};function i(e,t){if(n(t))return!!t(e);for(var r in t)if(t[r]!==e[r])return!1;return!0}function o(e,t){for(var r=0;r<e.length;r++)if(i(e[r],t))return r;return-1}t.findIndex=o,t.find=function(e,t){var r=o(e,t);return-1!==r?e[r]:null}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(28),a=r(36),u=function(r){function e(e){var t=r.call(this,e)||this;return t.geometry=new o.default,t.materials={default:new a.default},t}return i(e,r),e}(r(40).default);t.default=u},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(37),a=r(16),u=r(38),s=r(39),f=function(t){function e(){var e=t.call(this,{name:"G3D_PHONG",vertexShaderSource:s,fragmentShaderSource:u,macros:["PHONG_TEXTURE","PHONG_AMBIENT_TEXTURE","PHONG_DIFFUSE_TEXTURE","PHONG_SPECULAR_TEXTURE","PHONG_SPECULAR_ENV_MAP_TEXTURE"],uniforms:["uAmbientColor","uAmbientTexture","uDiffuseColor","uDiffuseTexture","uSpecularColor","uSpecularTexture","uGlossiness","uSpecularEnvMapTexture"],lighting:!0,shadow:!0})||this;return e.ambientColor={r:255,g:255,b:255},e.diffuseColor={r:255,g:255,b:255},e.specularColor={r:255,g:255,b:255},e.glossiness=1,e.ambientColorValues=a.default.create(),e.diffuseColorValues=a.default.create(),e.specularColorValues=a.default.create(),e.glossinessValue=new Float32Array([0]),e}return i(e,t),e.prototype.condition=function(e){switch(e){case"PHONG_AMBIENT_TEXTURE":return!!this.ambientTexture;case"PHONG_DIFFUSE_TEXTURE":return!!this.diffuseTexture;case"PHONG_SPECULAR_TEXTURE":return!!this.specularTexture;case"PHONG_TEXTURE":return!!this.ambientTexture||!!this.diffuseTexture||!!this.specularTexture;case"PHONG_SPECULAR_ENV_MAP_TEXTURE":return!!this.specularEnvMapTexture;default:return t.prototype.condition.call(this,e)}},e.prototype.uniform=function(e){switch(e){case"uAmbientColor":return this.getAmbientColor();case"uAmbientTexture":return this.getAmbientTexture();case"uDiffuseColor":return this.getDiffuseColor();case"uDiffuseTexture":return this.getDiffuseTexture();case"uSpecularColor":return this.getSpecularColor();case"uSpecularTexture":return this.getSpecularTexture();case"uGlossiness":return this.getGlossiness();case"uSpecularEnvMapTexture":return this.getSpecularEnvMapTexture();default:return t.prototype.uniform.call(this,e)}},e.prototype.getAmbientColor=function(){return a.default.set(this.ambientColorValues,this.ambientColor.r/255,this.ambientColor.g/255,this.ambientColor.b/255),this.ambientColorValues},e.prototype.getAmbientTexture=function(){return this.ambientTexture?this.ambientTexture.glTexture:null},e.prototype.getDiffuseColor=function(){return a.default.set(this.diffuseColorValues,this.diffuseColor.r/255,this.diffuseColor.g/255,this.diffuseColor.b/255),this.diffuseColorValues},e.prototype.getDiffuseTexture=function(){return this.diffuseTexture?this.diffuseTexture.glTexture:null},e.prototype.getSpecularColor=function(){return a.default.set(this.specularColorValues,this.specularColor.r/255,this.specularColor.g/255,this.specularColor.b/255),this.specularColorValues},e.prototype.getSpecularTexture=function(){return this.specularTexture?this.specularTexture.glTexture:null},e.prototype.getSpecularEnvMapTexture=function(){return this.specularEnvMapTexture?this.specularEnvMapTexture.glTexture:null},e.prototype.getGlossiness=function(){return this.glossinessValue[0]=this.glossiness,this.glossinessValue},e}(o.default);t.default=f},function(e,t,r){"use strict";var n=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},i=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(n(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var m=r(5),o=function(){function g(e){var t=e.name,r=e.vertexShaderSource,n=e.fragmentShaderSource,i=e.macros,o=void 0===i?[]:i,a=e.uniforms,u=void 0===a?[]:a,s=e.lighting,f=void 0!==s&&s,l=e.shadow,c=void 0!==l&&l,d=e.camera,h=void 0!==d&&d,p=e.passes,v=void 0===p?[{depthTest:!0,blend:!1,cullFace:!0,uniforms:[]}]:p;g.shaders[t]||(g.shaders[t]=new m.default({vShaderSource:r,fShaderSource:n})),this.shader=g.shaders[t],this.macros=o,this.uniforms=u,this.lighting=f,this.shadow=c,this.camera=h,this.passes=v}return g.prototype.getProgram=function(e){var t=this,r=this.macros.filter(function(e){return t.condition(e)});return this.shader.program(i(r,e))},g.prototype.condition=function(e){return!1},g.prototype.uniform=function(e){return null},g.shaders={},g}();t.default=o},function(e,t){e.exports="precision highp float;\n\n#define PI 3.1415926\n\n#define LIGHT_MAX_COUNT 16\n#define LIGHT_TYPE_NULL 1\n#define LIGHT_TYPE_AMBIENT 2\n#define LIGHT_TYPE_DIRECTIONAL 3\n#define LIGHT_TYPE_POINT 4\n\nuniform vec3 uCameraPosition;\n\nuniform int uLightType[LIGHT_MAX_COUNT];\nuniform vec3 uLightColor[LIGHT_MAX_COUNT];\nuniform float uLightIntensity[LIGHT_MAX_COUNT];\nuniform vec3 uLightPosition[LIGHT_MAX_COUNT];\n\nuniform vec3 uAmbientColor;\nuniform vec3 uDiffuseColor;\nuniform vec3 uSpecularColor;\n\nuniform float uGlossiness;\n\nvarying vec3 vNormal;\nvarying vec3 vPosition;\n\n#ifdef PHONG_TEXTURE\nvarying vec2 vUV;\n#endif\n\n#ifdef PHONG_AMBIENT_TEXTURE\nuniform sampler2D uAmbientTexture;\n#endif\n\n#ifdef PHONG_DIFFUSE_TEXTURE\nuniform sampler2D uDiffuseTexture;\n#endif\n\n#ifdef PHONG_SPECULAR_TEXTURE\nuniform sampler2D uSpecularTexture;\n#endif\n\n#ifdef PHONG_SPECULAR_ENV_MAP_TEXTURE\nuniform sampler2D uSpecularEnvMapTexture;\n#endif\n\n#ifdef CAST_SHADOW\nuniform mat4 uShadowPMatrix;\nuniform mat4 uShadowVMatrix;\nuniform sampler2D uShadowMapTexture;\n#endif\n\n#ifdef PHONG_SPECULAR_ENV_MAP_TEXTURE\nvec2 des2pol(vec3 pos){\n    float r = distance(vec2(pos.x, pos.z), vec2(0.0));\n    float beta = atan(pos.y, r);\n    float v = beta / PI + 0.5;\n    float alpha = atan(pos.x, pos.z);\n    float u = alpha / (PI * 2.0) + 0.5;\n    return vec2(u, v);\n}\n#endif\n\nvec3 applyLights(vec3 ambientColorSource, vec3 diffuseColorSource, vec3 specularColorSource){\n    vec3 colorLighted = vec3(0.0);\n\n    vec3 nNormal = normalize(vNormal);\n\n    vec3 nViewDirection = normalize(uCameraPosition - vPosition);\n\n    #ifdef PHONG_SPECULAR_ENV_MAP_TEXTURE\n    vec3 viewReflect = reflect(-nViewDirection, nNormal);\n    vec2 viewReflectUV = des2pol(viewReflect);\n    vec3 envMapFactor = texture2D(uSpecularEnvMapTexture, viewReflectUV).rgb;\n    specularColorSource *= envMapFactor;\n    #endif\n\n    for(int i = 0; i < LIGHT_MAX_COUNT; i++){\n\n        int type = uLightType[i];\n\n        if(type == LIGHT_TYPE_DIRECTIONAL){\n\n            vec3 nLightDir = normalize(uLightPosition[i]);\n\n            float factorLambert = max(dot(nNormal, nLightDir), 0.0);\n            vec3 diffuseIncrement = factorLambert * uLightColor[i] * uLightIntensity[i] * diffuseColorSource;\n            colorLighted += diffuseIncrement;\n\n            float factorPhong = pow(max(dot(reflect(-nLightDir, nNormal), nViewDirection), 0.0), uGlossiness) * factorLambert;\n            vec3 specularIncrement = factorPhong * uLightColor[i] * uLightIntensity[i] * specularColorSource;\n            colorLighted += specularIncrement;\n\n        }else if(type == LIGHT_TYPE_POINT){\n\n            vec3 ray = uLightPosition[i] - vPosition;\n            float rayLen = length(ray);\n            float decayedIntensity = 1.0 / (rayLen * rayLen) * uLightIntensity[i];\n\n            vec3 nLightDir = normalize(ray);\n\n            float factorLambert = abs(dot(normalize(vNormal), nLightDir));\n            vec3 diffuseIncrement = factorLambert * uLightColor[i] * decayedIntensity * diffuseColorSource;\n            colorLighted += diffuseIncrement;\n\n            float factorPhong = pow(max(dot(reflect(-nLightDir, nNormal), nViewDirection), 0.0), uGlossiness) * factorLambert;\n            vec3 specularIncrement = factorPhong * uLightColor[i] * decayedIntensity * specularColorSource;\n            colorLighted += specularIncrement;\n\n        }else if(type == LIGHT_TYPE_AMBIENT){\n\n            vec3 increment = uLightColor[i] * uLightIntensity[i] * ambientColorSource;\n            colorLighted += increment;\n\n        }\n    }\n\n    return colorLighted;\n}\n\nvoid main() {\n\n    #ifdef PHONG_AMBIENT_TEXTURE\n    vec3 ambient = texture2D(uAmbientTexture, vUV).rgb * uAmbientColor;\n    #else\n    vec3 ambient = uAmbientColor;\n    #endif\n\n    #ifdef PHONG_DIFFUSE_TEXTURE\n    vec3 diffuse = texture2D(uDiffuseTexture, vUV).rgb * uDiffuseColor;\n    #else\n    vec3 diffuse = uDiffuseColor;\n    #endif\n\n    #ifdef PHONG_SPECULAR_TEXTURE\n    vec3 specular = texture2D(uSpecularTexture, vUV).rgb * uSpecularColor;\n    #else\n    vec3 specular = uSpecularColor;\n    #endif\n\n    gl_FragColor = vec4(applyLights(ambient, diffuse, specular), 1.0);\n\n    #ifdef CAST_SHADOW\n    vec4 shadowPosition = uShadowPMatrix * uShadowVMatrix * vec4(vPosition, 1.0);\n    vec3 shadowCoord = (shadowPosition.xyz / shadowPosition.w)/2.0 + 0.5;\n    float shadowDepth = texture2D(uShadowMapTexture, shadowCoord.xy).r;\n    if(shadowCoord.z > shadowDepth + 0.01){\n        gl_FragColor = vec4(gl_FragColor.xyz*0.7, 1.0);\n    }\n    #endif\n}"},function(e,t){e.exports="precision highp float;\n\nattribute vec3 aPosition;\nattribute vec3 aNormal;\n\nuniform mat4 uPMatrix;\nuniform mat4 uVMatrix;\nuniform mat4 uMMatrix;\n\nvarying vec3 vPosition;\nvarying vec3 vNormal;\n\n#ifdef PHONG_TEXTURE\nattribute vec2 aUV;\nvarying vec2 vUV;\n#endif\n\nvoid main() {\n\n    gl_Position = uPMatrix * uVMatrix * uMMatrix * vec4(aPosition, 1.0);\n\n    vNormal = normalize((uMMatrix * vec4( aNormal, 0.0)).xyz);\n    vPosition = (uMMatrix * vec4(aPosition, 1.0)).xyz;\n\n    #ifdef PHONG_TEXTURE\n    vUV = aUV;\n    #endif\n}\n"},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(13),a=r(34),u=function(r){function t(e){var t=r.call(this)||this;return t.visibility=!0,t.pickable=!0,t.renderLayerIndex=0,e&&(e.meshes.push(t),t.scene=e),t}return i(t,r),t.prototype.getGlobalVisibility=function(){for(var e=this;e;){if(e instanceof t&&!e.visibility)return!1;e=e.parent}return!0},t.prototype.getPickable=function(){return this.pickable},t.prototype.getRenderLayerIndex=function(){for(var e=this;e;){if(e instanceof t&&0!==e.renderLayerIndex)return e.renderLayerIndex;e=e.parent}return 0},t.prototype.dispose=function(){if(this.scene){var e=a.findIndex(this.scene.meshes,{id:this.id});-1!==e&&this.scene.meshes.splice(e,1)}},t}(o.default);t.default=u},function(e,t,r){"use strict";var _=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}},T=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a};Object.defineProperty(t,"__esModule",{value:!0});var E=r(4),u=r(26),n=function(){function e(e){var t,r,n=e.images,i=e.sRGB,o=void 0!==i&&i,a=e.flipY,u=void 0!==a&&a;this.mipLevel=0,this.targets=new Map([["right",E.default.gl.TEXTURE_CUBE_MAP_POSITIVE_X],["left",E.default.gl.TEXTURE_CUBE_MAP_NEGATIVE_X],["top",E.default.gl.TEXTURE_CUBE_MAP_POSITIVE_Y],["bottom",E.default.gl.TEXTURE_CUBE_MAP_NEGATIVE_Y],["front",E.default.gl.TEXTURE_CUBE_MAP_POSITIVE_Z],["back",E.default.gl.TEXTURE_CUBE_MAP_NEGATIVE_Z]]);var s=E.default.gl,f=E.default.textures,l=E.default.extensions;this.checkImages(n);var c=this.glTexture=s.createTexture();s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_CUBE_MAP,c);var d=l.get("SRGB");this.sRGB=o=o&&!!d,this.size=n.left.width,this.mipLevel=Math.log2(this.size),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,s.LINEAR),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,u?1:0);var h=o?d.SRGB_EXT:s.RGBA;try{for(var p=_(this.targets),v=p.next();!v.done;v=p.next()){var g=T(v.value,2),m=g[0],y=g[1];s.texImage2D(y,0,h,h,s.UNSIGNED_BYTE,n[m])}}catch(e){t={error:e}}finally{try{v&&!v.done&&(r=p.return)&&r.call(p)}finally{if(t)throw t.error}}n.mip&&this.setMipmaps(n.mip),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,0),f.add(this)}return e.prototype.setMipmaps=function(e){var t,r;if(this.mipLevel!==e.length)throw new Error("Mipmap level length error.");var n=E.default.gl,i=E.default.extensions,o=this.sRGB?i.get("SRGB").SRGB_EXT:n.RGBA;n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MIN_FILTER,n.LINEAR_MIPMAP_LINEAR);for(var a=0;a<e.length;a++){var u=e[a];this.checkImages(u,Math.pow(2,e.length-1-a));try{for(var s=_(this.targets),f=s.next();!f.done;f=s.next()){var l=T(f.value,2),c=l[0],d=l[1];n.texImage2D(d,a+1,o,o,n.UNSIGNED_BYTE,u[c])}}catch(e){t={error:e}}finally{try{f&&!f.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}}},e.prototype.destructor=function(){var e=E.default.gl,t=E.default.textures;e.deleteTexture(this.glTexture),t.delete(this)},e.prototype.checkImages=function(e,t){var r,n;void 0===t&&(t=e.left.width);try{for(var i=_(["left","right","top","bottom","front","back"]),o=i.next();!o.done;o=i.next()){var a=e[o.value];if(a.width!==t||a.height!==t||!0!==u.isPowerOf2(a.width)||!0!==u.isPowerOf2(a.height))throw new Error("CubeTexture image size error.")}}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}},e}();t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var E=r(4),b=r(26),n=function(){function e(e){var t=e.image,r=e.sRGB,n=void 0!==r&&r,i=e.flipY,o=void 0===i||i,a=e.repeat,u=void 0===a||a,s=e.mipmap,f=void 0===s||s,l=e.mip,c=void 0===l?null:l;this.mipLevel=0;var d=E.default.gl,h=E.default.textures,p=E.default.extensions,v=this.glTexture=d.createTexture();d.activeTexture(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,v);var g=t.width,m=t.height,y=g===m&&b.isPowerOf2(g)&&b.isPowerOf2(m),_=p.get("SRGB");u=u&&y,n=n&&_,f=f&&y&&!n,this.mipmap=f,this.sRGB=n,this.width=g,d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,u?d.REPEAT:d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,u?d.REPEAT:d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,f?d.NEAREST_MIPMAP_LINEAR:d.LINEAR),d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,o?1:0);var T=n?_.SRGB_EXT:d.RGBA;d.texImage2D(d.TEXTURE_2D,0,T,T,d.UNSIGNED_BYTE,t),f&&(d.generateMipmap(d.TEXTURE_2D),this.mipLevel=Math.log2(this.width)),f&&c&&this.setMipmaps(c),d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,0),h.add(this)}return e.prototype.setMipmaps=function(e){if(this.mipmap){var t=E.default.gl,r=E.default.extensions,n=this.sRGB?r.get("SRGB").SRGB_EXT:t.RGBA;if(e.length!==Math.log2(this.width))throw new Error("Mipmap length invalid.");for(var i=0;i<e.length;i++){var o=e[i],a=Math.pow(2,e.length-i-1);if(o.width!==a||o.height!==a)throw new Error("Mipmap image size invalid.");t.texImage2D(t.TEXTURE_2D,i+1,n,n,t.UNSIGNED_BYTE,o)}}},e.prototype.destructor=function(){var e=E.default.gl,t=E.default.textures;e.deleteTexture(this.glTexture),t.delete(this)},e}();t.default=n},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(22),a=r(4),u=r(26),s=function(o){function e(e){var t=o.call(this)||this;t.radius=100,t.alpha=45,t.beta=45;var r=a.default.width,n=a.default.height;return t.viewRatio=r/n,e.activeCamera=t}return i(e,o),e.prototype.getVMatrix=function(){var e=Math.cos(u.deg2rad(this.beta))*this.radius,t=Math.sin(u.deg2rad(this.beta))*this.radius,r=Math.sin(u.deg2rad(this.alpha))*e,n=Math.cos(u.deg2rad(this.alpha))*e,i=this.center;return this.position.x=i.x+r,this.position.y=i.y+t,this.position.z=i.z+n,o.prototype.getVMatrix.call(this)},e.prototype.getViewRay=function(e,t,r){},e}(o.default);t.default=s},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(25),a=r(4),u=r(26),s=function(o){function e(e){var t=o.call(this)||this;t.radius=100,t.alpha=45,t.beta=45;var r=a.default.width,n=a.default.height;return t.viewRatio=r/n,e.activeCamera=t}return i(e,o),e.prototype.getVMatrix=function(){var e=Math.cos(u.deg2rad(this.beta))*this.radius,t=Math.sin(u.deg2rad(this.beta))*this.radius,r=Math.sin(u.deg2rad(this.alpha))*e,n=Math.cos(u.deg2rad(this.alpha))*e,i=this.center;return this.position.x=i.x+r,this.position.y=i.y+t,this.position.z=i.z+n,o.prototype.getVMatrix.call(this)},e.prototype.getViewRay=function(e,t,r){var n=a.default.width,i=a.default.height;return o.prototype.getViewRay.call(this,e/n,t/i,r)},e}(o.default);t.default=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(28),o=r(41),n=function(e,t,r){void 0===r&&(r=100);var n=[-r,r,r,-r,-r,r,r,-r,r,r,r,r,r,r,-r,r,-r,-r,-r,-r,-r,-r,r,-r,-r,r,-r,-r,-r,-r,-r,-r,r,-r,r,r,r,r,r,r,-r,r,r,-r,-r,r,r,-r,-r,r,-r,-r,r,r,r,r,r,r,r,-r,-r,-r,r,-r,-r,-r,r,-r,-r,r,-r,r];(e.skybox=this).geometry=new i.default({vertices:n,indices:{default:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]},facing:i.default.FACING.BACK}),this.cubeTexture=new o.default({images:{front:t.front,back:t.back,left:t.left,right:t.right,top:t.top,bottom:t.bottom}})};t.default=n},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(47),a=r(48),u=function(r){function e(e){var t=r.call(this,e)||this;return t.geometry=new o.default,t.materials={default:new a.default},t.lineWidth=2,t}return i(e,r),e}(r(40).default);t.default=u},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(s){function e(e){var t=void 0===e?{}:e,r=t.vertices,n=t.indices,i=s.call(this)||this;if(r){for(var o=[],a=[],u=0;u<r.length;u+=3)o.push(0,0,1),a.push(0,0);i.bufferViews={vertices:i.createBufferView(r),normals:i.createBufferView(o),uvs:i.createBufferView(a),indices:i.createElementBufferView(n,!0)}}return i}return i(e,s),e}(r(29).default);t.default=o},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(37),a=r(16),u=r(49),s=r(50),f=function(t){function e(){var e=t.call(this,{name:"G3D_RAW",vertexShaderSource:s,fragmentShaderSource:u,macros:["RAW_TEXTURE"],uniforms:["uColor","uTexture"],lighting:!1,shadow:!1})||this;return e.color={r:255,g:255,b:255},e.colorValues=a.default.create(),e}return i(e,t),e.prototype.condition=function(e){switch(e){case"RAW_TEXTURE":return!!this.texture;default:return t.prototype.condition.call(this,e)}},e.prototype.uniform=function(e){switch(e){case"uColor":return this.getColor();case"uTexture":return this.getTexture();default:return null}},e.prototype.getColor=function(){return a.default.set(this.colorValues,this.color.r/255,this.color.g/255,this.color.b/255),this.colorValues},e.prototype.getTexture=function(){return this.texture?this.texture.glTexture:null},e}(o.default);t.default=f},function(e,t){e.exports="#ifdef GL_ES\nprecision mediump float;\n#endif\n\nuniform vec3 uColor;\n\n#ifdef RAW_TEXTURE\nuniform sampler2D uTexture;\nvarying vec2 vUV;\n#endif\n\nvoid main() {\n\n    #ifdef RAW_TEXTURE\n        gl_FragColor = vec4(texture2D(uTexture, vUV).rgb * uColor.rgb, 1.0);\n    #else\n        gl_FragColor = vec4(uColor, 1.0);\n    #endif\n\n}\n"},function(e,t){e.exports="precision mediump float;\n\nattribute vec3 aPosition;\n\nuniform mat4 uPMatrix;\nuniform mat4 uVMatrix;\nuniform mat4 uMMatrix;\n\n#ifdef RAW_TEXTURE\nattribute vec2 aUV;\nvarying vec2 vUV;\n#endif\n\nvoid main() {\n    gl_Position = uPMatrix * uVMatrix * uMMatrix * vec4(aPosition, 1.0);\n\n    #ifdef RAW_TEXTURE\n    vUV = aUV;\n    #endif\n}\n"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(41),u=r(42),n=function(e){var t=e.diffuse,r=e.specular,n=e.brdfLUT,i=e.sRGB,o=void 0!==i&&i;this.greyness=0,this.diffuse=new a.default({images:t,sRGB:o}),this.specular=new a.default({images:r,sRGB:o}),this.brdfLUT=new u.default({image:n,sRGB:!1,flipY:!1,repeat:!1})};t.default=n},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(37),a=r(16),u=r(53),s=r(54),f=function(t){function e(){var e=t.call(this,{name:"G3D_SHADER",vertexShaderSource:s,fragmentShaderSource:u,macros:["PBR_NORMAL_TEXTURE","PBR_ALBEDO_TEXTURE","PBR_METALLIC_ROUGHNESS_TEXTURE","PBR_EMISSIVE_TEXTURE","PBR_OCCLUSION_TEXTURE","PBR_ENVIROMENT"],uniforms:["uMaterialAlbedoColor","uMaterialAlbedoTexture","uMaterialRoughness","uMaterialMetallic","uMaterialMetallicRoughnessTexture","uMaterialEmissiveTexture","uMaterialOcclusionTexture","uMaterialOcclusionStrength","uMaterialNormalTexture","uSpecularMap","uSpecularMipLevel","uDiffuseMap","uBRDFLUT","uGreyness"],lighting:!0,shadow:!1,camera:!0})||this;return e.albedoColor={r:255,g:255,b:255},e.metallic=0,e.roughness=.1,e.occlusionStrength=0,e.albedoColorValues=a.default.create(),e.metallicValue=new Float32Array([0]),e.roughnessValue=new Float32Array([0]),e}return i(e,t),e.prototype.condition=function(e){switch(e){case"PBR_NORMAL_TEXTURE":return!!this.normalTexture;case"PBR_ALBEDO_TEXTURE":return!!this.albedoTexture;case"PBR_METALLIC_ROUGHNESS_TEXTURE":return!!this.metallicRoughnessTexture;case"PBR_EMISSIVE_TEXTURE":return!!this.emissiveTexture;case"PBR_OCCLUSION_TEXTURE":return!!this.occlusionTexture;case"PBR_ENVIROMENT":return!!this.pbrEnviroment;default:return t.prototype.condition.call(this,e)}},e.prototype.uniform=function(e){switch(e){case"uMaterialAlbedoColor":return this.getAlbedoColor();case"uMaterialAlbedoTexture":return this.getAlbedoTexture();case"uMaterialRoughness":return this.getRoughness();case"uMaterialMetallic":return this.getMetallic();case"uMaterialMetallicRoughnessTexture":return this.getMetallicRoughnessTexture();case"uMaterialEmissiveTexture":return this.getEmissiveTexture();case"uMaterialNormalTexture":return this.getNormalTexture();case"uSpecularMap":return this.getSpecularMap();case"uDiffuseMap":return this.getDiffuseMap();case"uMaterialOcclusionTexture":return this.getOcclusionTexture();case"uMaterialOcclusionStrength":return this.getOcclusionStrength();case"uBRDFLUT":return this.getBRDFLUT();case"uSpecularMipLevel":return this.getSpecularMipLevel();case"uGreyness":return this.getGreyness();default:return t.prototype.uniform.call(this,e)}},e.prototype.getAlbedoColor=function(){return a.default.set(this.albedoColorValues,this.albedoColor.r/255,this.albedoColor.g/255,this.albedoColor.b/255),this.albedoColorValues},e.prototype.getAlbedoTexture=function(){return this.albedoTexture?this.albedoTexture.glTexture:null},e.prototype.getMetallic=function(){return this.metallicValue[0]=this.metallic,this.metallicValue},e.prototype.getRoughness=function(){return this.roughnessValue[0]=this.roughness,this.roughnessValue},e.prototype.getMetallicRoughnessTexture=function(){return this.metallicRoughnessTexture?this.metallicRoughnessTexture.glTexture:null},e.prototype.getEmissiveTexture=function(){return this.emissiveTexture?this.emissiveTexture.glTexture:null},e.prototype.getOcclusionTexture=function(){return this.occlusionTexture?this.occlusionTexture.glTexture:null},e.prototype.getOcclusionStrength=function(){return[this.occlusionStrength]},e.prototype.getNormalTexture=function(){return this.normalTexture?this.normalTexture.glTexture:null},e.prototype.getSpecularMap=function(){return this.pbrEnviroment?this.pbrEnviroment.specular.glTexture:null},e.prototype.getSpecularMipLevel=function(){return this.pbrEnviroment?[this.pbrEnviroment.specular.mipLevel]:null},e.prototype.getDiffuseMap=function(){return this.pbrEnviroment?this.pbrEnviroment.diffuse.glTexture:null},e.prototype.getBRDFLUT=function(){return this.pbrEnviroment?this.pbrEnviroment.brdfLUT.glTexture:null},e.prototype.getGreyness=function(){return this.pbrEnviroment?new Float32Array([this.pbrEnviroment.greyness]):null},e}(o.default);t.default=f},function(e,t){e.exports="#ifdef EXT_TEX_LOD\n#extension GL_EXT_shader_texture_lod: enable\n#endif\n\n#ifdef EXT_DER\n#extension GL_OES_standard_derivatives : enable\n#endif\n\n#ifdef PRECISION_FLOAT_HIGHP\nprecision highp float;\n#endif\n\n#ifdef PRECISION_FLOAT_MEDIUMP\nprecision mediump float;\n#endif\n\n#ifdef PRECISION_FLOAT_LOWP\nprecision lowp float;\n#endif\n\n#define PI 3.1415926\n\n#define LIGHT_MAX_COUNT 16\n#define LIGHT_TYPE_NULL 1\n#define LIGHT_TYPE_AMBIENT 2\n#define LIGHT_TYPE_DIRECTIONAL 3\n#define LIGHT_TYPE_POINT 4\n\nuniform vec3 uCameraPosition;\n\nuniform int uLightType[LIGHT_MAX_COUNT];\nuniform vec3 uLightColor[LIGHT_MAX_COUNT];\nuniform float uLightIntensity[LIGHT_MAX_COUNT];\nuniform vec3 uLightPosition[LIGHT_MAX_COUNT];\n\nuniform vec3 uMaterialAlbedoColor;\nuniform float uMaterialRoughness;\nuniform float uMaterialMetallic;\n\n#ifdef PBR_ENVIROMENT\nuniform samplerCube uSpecularMap;\nuniform samplerCube uDiffuseMap;\nuniform sampler2D uBRDFLUT;\nuniform int uSpecularMipLevel;\n\nuniform float uGreyness;\nvec3 greyness(vec3 c){\n    float m = (c[0] + c[1] + c[2])/3.0;\n    return vec3(\n        c[0] + (m - c[0]) * uGreyness,\n        c[1] + (m - c[1]) * uGreyness,\n        c[2] + (m - c[2]) * uGreyness\n    );\n}\n#endif\n\nvarying vec3 vPosition;\nvarying vec3 vNormal;\n\n#ifdef PBR_NORMAL_TEXTURE\nvarying vec2 vNormalUV;\nuniform sampler2D uMaterialNormalTexture;\n#endif\n\n#ifdef PBR_ALBEDO_TEXTURE\nvarying vec2 vAlbedoUV;\nuniform sampler2D uMaterialAlbedoTexture;\n#endif\n\n#ifdef PBR_METALLIC_ROUGHNESS_TEXTURE\nvarying vec2 vMetallicRoughnessUV;\nuniform sampler2D uMaterialMetallicRoughnessTexture;\n#endif\n\n#ifdef PBR_EMISSIVE_TEXTURE\nvarying vec2 vEmissiveUV;\nuniform sampler2D uMaterialEmissiveTexture;\n#endif\n\n#ifdef PBR_OCCLUSION_TEXTURE\nvarying vec2 vOcclusionUV;\nuniform sampler2D uMaterialOcclusionTexture;\nuniform float uMaterialOcclusionStrength;\n#endif\n\nstruct PBRInfo\n{\n    vec3 N;\n    vec3 V;\n    vec3 baseColor;\n    float roughness;\n    float metallic;\n};\n\nstruct PP{\n    vec3 color;\n};\n\nstruct PBRLightInfo\n{\n    vec3 color;\n    vec3 L;\n    float intensity;\n};\n\n\n#ifdef PBR_NORMAL_TEXTURE\n#ifdef EXT_DER\nvec3 getNormal(){\n    vec3 pos_dx = dFdx(vPosition);\n    vec3 pos_dy = dFdy(vPosition);\n    vec3 tex_dx = dFdx(vec3(vNormalUV, 0.0));\n    vec3 tex_dy = dFdy(vec3(vNormalUV, 0.0));\n    vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);\n    vec3 ng = normalize(vNormal);\n    t = normalize(t - ng * dot(ng, t));\n    vec3 b = normalize(cross(ng, t));\n    mat3 tbn = mat3(t, b, ng);\n    vec3 n = texture2D(uMaterialNormalTexture, vNormalUV).rgb;\n    n = normalize(tbn * ((2.0 * n - 1.0) * vec3(1.0, 1.0, 1.0)));\n    return n;\n}\n#endif\n#endif\n\n\nvec3 L_direct(PBRInfo info, PBRLightInfo light){\n    \n    float NDotL = clamp(dot(info.N, light.L), 0.0, 1.0);\n    float NDotV = clamp(dot(info.N, info.V), 0.0, 1.0);\n\n    vec3 F0 = mix(vec3(0.04), info.baseColor, info.metallic);\n    vec3 ks = F0 + (1.0 - F0) * pow(1.0 - NDotV, 5.0);\n    vec3 kd = 1.0 - ks;\n    kd *= 1.0 - info.metallic;\n\n    vec3 diffuse = kd * info.baseColor / PI;\n\n    vec3 H = normalize(light.L + info.V);\n    float NDotH = clamp(dot(info.N, H), 0.0, 1.0);\n\n    float roughness = info.roughness;\n\n    float D = (roughness * roughness) / max(0.001, PI * pow(NDotH * NDotH * (roughness * roughness - 1.0) + 1.0 , 2.0));\n    \n    float k = (roughness + 1.0) * (roughness + 1.0) / 8.0;\n    float G1 = NDotV / max(0.001, NDotV * (1.0 - k) + k);\n    float G2 = NDotL / max(0.001, NDotL * (1.0 - k) + k);\n    float G = G1 * G2;\n\n    vec3 specular = vec3(D * G1 * G2) * ks / max(0.001, NDotL * NDotV * PI * 4.0);\n\n    vec3 Li = light.color * light.intensity;\n\n    return (diffuse + specular) * NDotL * Li;\n}\n\n#ifdef PBR_ENVIROMENT\nvec3 L_env(PBRInfo info){\n\n    float NdotV = clamp(dot(info.N, info.V), 0.0, 1.0);\n\n    vec3 diffuseLight = textureCube(uDiffuseMap, info.N).rgb;\n    vec3 diffuseColor = info.baseColor * ( 1.0 - 0.04 ) * ( 1.0 - info.metallic );\n    vec3 diffuse = diffuseLight * diffuseColor;\n\n    vec3 R = -normalize(reflect(info.V, info.N));\n    #ifdef EXT_TEX_LOD\n    vec3 specularLight = textureCubeLodEXT(uSpecularMap, R, info.roughness * float(uSpecularMipLevel)).rgb;\n    specularLight = greyness(specularLight);\n    #else\n    vec3 specularLight = textureCube(uSpecularMap, R).rgb;\n    #endif\n\n    vec3 specularColor = mix(vec3(0.04), info.baseColor, info.metallic);\n\n    vec2 brdf = texture2D(uBRDFLUT, vec2(NdotV, 1.0 - info.roughness)).rg;\n\n    vec3 specular = specularLight * (specularColor * brdf.x + brdf.y);\n\n    return diffuse + specular;\n}\n#endif\n\n\nvec3 L(){\n\n    vec3 fragColor = vec3(0.0, 0.0, 0.0);\n\n    PBRInfo pbrInputs = PBRInfo(\n\n        #ifdef EXT_DER\n        #ifdef PBR_NORMAL_TEXTURE\n        getNormal(),\n        #else\n        vNormal,\n        #endif\n        #else\n        vNormal,\n        #endif\n\n        normalize(uCameraPosition - vPosition),\n\n        #ifdef PBR_ALBEDO_TEXTURE\n        uMaterialAlbedoColor * texture2D(uMaterialAlbedoTexture, fract(vAlbedoUV)).rgb,\n        #else\n        uMaterialAlbedoColor,\n        #endif\n\n        #ifdef PBR_METALLIC_ROUGHNESS_TEXTURE\n        uMaterialRoughness * texture2D(uMaterialMetallicRoughnessTexture, vMetallicRoughnessUV).g,\n        #else\n        uMaterialRoughness,\n        #endif\n\n        #ifdef PBR_METALLIC_ROUGHNESS_TEXTURE\n        uMaterialMetallic * texture2D(uMaterialMetallicRoughnessTexture, vMetallicRoughnessUV).b\n        #else\n        uMaterialMetallic\n        #endif\n    );\n\n    for(int i = 0; i < LIGHT_MAX_COUNT; i++){\n\n        int type = uLightType[i];\n\n        if(type == LIGHT_TYPE_DIRECTIONAL){\n\n            fragColor += L_direct(\n                pbrInputs,\n                PBRLightInfo(\n                    uLightColor[i],\n                    normalize(uLightPosition[i]),\n                    uLightIntensity[i]\n                )\n            );\n        }else if(type == LIGHT_TYPE_POINT){\n\n            float dir = length(uLightPosition[i] - vPosition);\n\n            fragColor += L_direct(\n                pbrInputs,\n                PBRLightInfo(\n                    uLightColor[i],\n                    normalize(uLightPosition[i]-vPosition),\n                    uLightIntensity[i] / (dir * dir)\n                )\n            );\n        }\n    }\n\n    #ifdef PBR_ENVIROMENT\n    fragColor += L_env(pbrInputs);\n    #endif\n\n    #ifdef PBR_OCCLUSION_TEXTURE\n    fragColor = mix(\n        fragColor, \n        fragColor * texture2D(uMaterialOcclusionTexture, vOcclusionUV).r, \n        uMaterialOcclusionStrength\n    );\n    #endif\n\n    #ifdef PBR_EMISSIVE_TEXTURE\n    fragColor += texture2D(uMaterialEmissiveTexture, vEmissiveUV).rgb;\n    #endif\n\n    fragColor = pow(fragColor, vec3(1.0/2.2));\n\n    return fragColor;\n}\n\nvoid main() {\n\n    gl_FragColor = vec4(L(), 1.0);\n\n}\n"},function(e,t){e.exports="precision highp float;\n\nattribute vec3 aPosition;\nattribute vec3 aNormal;\n\nuniform mat4 uPMatrix;\nuniform mat4 uVMatrix;\nuniform mat4 uMMatrix;\n\nvarying vec3 vPosition;\nvarying vec3 vNormal;\n\n#ifdef PBR_NORMAL_TEXTURE\nattribute vec2 aNormalUV;\nvarying vec2 vNormalUV;\n#endif\n\n#ifdef PBR_ALBEDO_TEXTURE\nattribute vec2 aAlbedoUV;\nvarying vec2 vAlbedoUV;\n#endif\n\n#ifdef PBR_METALLIC_ROUGHNESS_TEXTURE\nattribute vec2 aMetallicRoughnessUV;\nvarying vec2 vMetallicRoughnessUV;\n#endif\n\n#ifdef PBR_EMISSIVE_TEXTURE\nattribute vec2 aEmissiveUV;\nvarying vec2 vEmissiveUV;\n#endif\n\n#ifdef PBR_OCCLUSION_TEXTURE\nattribute vec2 aOcclusionUV;\nvarying vec2 vOcclusionUV;\n#endif\n\nvoid main() {\n\n    gl_Position = uPMatrix * uVMatrix * uMMatrix * vec4(aPosition, 1.0);\n\n    vPosition = (uMMatrix * vec4(aPosition, 1.0)).xyz;\n    vNormal = normalize((uMMatrix * vec4( aNormal, 0.0)).xyz);\n\n    #ifdef PBR_ALBEDO_TEXTURE\n    vAlbedoUV = aAlbedoUV;\n    #endif\n\n    #ifdef PBR_METALLIC_ROUGHNESS_TEXTURE\n    vMetallicRoughnessUV = aMetallicRoughnessUV;\n    #endif\n\n    #ifdef PBR_EMISSIVE_TEXTURE\n    vEmissiveUV = aEmissiveUV;\n    #endif\n\n    #ifdef PBR_OCCLUSION_TEXTURE\n    vOcclusionUV = aOcclusionUV;\n    #endif\n\n    #ifdef PBR_NORMAL_TEXTURE\n    vNormalUV = aNormalUV;\n    #endif\n}\n"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=r(56),n=r(57),i=r(58),o=r(59),a=r(60),s=r(61),f=r(62),l=r(63),c=r(65),d=r(67),h=r(69);t.default={createSphere:f.default,createPlane:a.default,createCircle:s.default,createCylinder:o.default,createCone:n.default,createCube:function(e,t,r,n){void 0===r&&(r=t),void 0===n&&(n=t);var i=t/2,o=r/2,a=n/2;return u.default(e,-i,i,o,-o,a,-a)},createCoordinate:i.default,createFromObjModel:d.default,createFromStlModel:h.default,createMeshFromGLTF:c.default,createLineFromPath:l.createLineFromPath,createMeshFromPath:l.createMeshFromPath}},function(e,t,r){"use strict";var n=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},l=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(n(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var c=r(28),d=r(35);t.default=function(e,t,r,n,i,o,a){var u=new d.default(e),s=[[t,i,o],[r,i,o],[r,n,o],[t,n,o],[t,i,a],[r,i,a],[r,n,a],[t,n,a]],f=[[0,0,1],[1,0,0],[0,0,-1],[-1,0,0],[0,1,0],[0,-1,0]];return u.geometry=new c.default({vertices:[0,1,2,3,1,5,6,2,5,4,7,6,4,0,3,7,3,2,6,7,4,5,1,0].reduce(function(e,t){return e.push.apply(e,l(s[t])),e},[]),normals:[0,1,2,3,4,5].reduce(function(e,t){for(var r=4;0<r;)e.push.apply(e,l(f[t])),r--;return e},[]),uvs:[0,1,2,3,4,5].reduce(function(e){return e.push(0,0,1,0,1,1,0,1),e},[]),indices:{default:[0,1,2,3,4,5].reduce(function(e,t){return e.push.apply(e,l([0,1,2,0,2,3].map(function(e){return e+4*t}))),e},[])}}),u}},function(e,t,r){"use strict";var n=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},T=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(n(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var i=r(28),o=r(35);t.default=function(e,c,d,h){void 0===h&&(h=16);var p=[],v=[],g=[],m=[],y=d/2,_=2*Math.PI/h;!function(){for(var e=p.length/3,t=[0,y,0],r=Math.atan(c/d),n=Math.cos(r),i=Math.sin(r),o=0;o<h;o++){var a=_*o,u=[Math.cos(a)*c,-y,Math.sin(a)*c],s=[Math.cos(a)*n,i,Math.sin(a)*n],f=[0,0];p.push.apply(p,T(t,u)),g.push.apply(g,T(s,s)),v.push.apply(v,T(f,f));var l=e+2*o;o!==h-1?m.push(l+1,l,l+3):m.push(l+1,l,e+1)}}(),function(e){var t=p.length/3,r=[0,y*e,0],n=[0,e,0],i=[0,0];p.push.apply(p,T(r)),g.push.apply(g,T(n)),v.push.apply(v,T(i));for(var o=0;o<h;o++){var a=o*_,u=[Math.cos(a)*c,y*e,Math.sin(a)*c];p.push.apply(p,T(u)),g.push.apply(g,T(n)),v.push.apply(v,T(i)),o!==h-1?m.push(t,t+o+1,t+o+2):m.push(t,t+o+1,t+1)}}(-1);var t=new o.default(e);return t.geometry=new i.default({vertices:p,normals:g,uvs:v,indices:{default:m}}),t}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var f=r(35),l=r(47),c=r(46),d=r(48);t.default=function(e,t){var r=new f.default(e),n=new c.default(e);n.geometry=new l.default({vertices:[0,0,0,t,0,0],indices:{default:[0,1]}});var i=new d.default;i.color={r:256,g:0,b:0},n.materials.default=i,n.parent=r;var o=new c.default(e);o.geometry=new l.default({vertices:[0,0,0,0,t,0],indices:{default:[0,1]}});var a=new d.default;a.color={r:0,g:256,b:0},o.materials.default=a,o.parent=r;var u=new c.default(e);u.geometry=new l.default({vertices:[0,0,0,0,0,t],indices:{default:[0,1]}});var s=new d.default;return s.color={r:0,g:0,b:256},u.materials.default=s,u.parent=r}},function(e,t,r){"use strict";var n=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},m=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(n(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var i=r(28),o=r(35);t.default=function(e,f,t,l){void 0===l&&(l=16);var c=[],d=[],h=[],p=[],v=2*Math.PI/l,g=t/2,r=function(e,t){void 0===t&&(t=!0);var r=c.length/3,n=[0,g*e,0],i=[0,e,0],o=[0,0];c.push.apply(c,m(n)),h.push.apply(h,m(i)),d.push.apply(d,m(o));for(var a=0;a<l;a++){var u=a*v,s=[Math.cos(u)*f,g*e,Math.sin(u)*f];c.push.apply(c,m(s)),h.push.apply(h,m(i)),d.push.apply(d,m(o)),t?a!==l-1?p.push(r,r+a+1,r+a+2):p.push(r,r+a+1,r+1):a!==l-1?p.push(r,r+a+2,r+a+1):p.push(r,r+1,r+a+1)}};!function(){for(var e=c.length/3,t=0;t<l;t++){var r=v*t,n=[Math.cos(r)*f,-g,Math.sin(r)*f],i=[Math.cos(r)*f,g,Math.sin(r)*f],o=[n[0],0,n[2]],a=[i[0],0,i[2]];c.push.apply(c,m(n,i)),d.push(0,0,0,0),h.push.apply(h,m(o,a));var u=2*t;t===l-1?p.push(u,u+1,e+1,u,e+1,e):p.push(u,u+1,u+3,u,u+3,u+2)}}(),r(1,!1),r(-1,!0);var n=new o.default(e);return n.geometry=new i.default({vertices:c,normals:h,uvs:d,indices:{default:p}}),n}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=r(28),s=r(35);t.default=function(e,t,r){void 0===r&&(r=t);var n=t/2,i=r/2,o=new s.default(e),a=[-n,-i,0,n,-i,0,n,i,0,-n,i,0];return o.geometry=new u.default({vertices:a,uvs:[0,0,1,0,1,1,0,1],normals:[0,0,1,0,0,1,0,0,1,0,0,1],indices:{default:[0,1,2,0,2,3]},facing:u.default.FACING.BOTH}),o}},function(e,t,r){"use strict";var n=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},g=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(n(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var m=r(28),y=r(35);t.default=function(e,t,r){void 0===r&&(r=16);var n=2*Math.PI,i=[],o=[],a=[],u=[],s=[0,0,1];o.push.apply(o,g([0,0,0])),a.push.apply(a,g(s)),u.push.apply(u,g([.5,.5]));for(var f=n/r,l=0;l<=r;l++){var c=l*f,d=Math.cos(0+c),h=Math.sin(0+c),p=[d*t,h*t,0];o.push.apply(o,g(p)),a.push.apply(a,g(s)),u.push((d+1)/2,(h+1)/2)}for(l=0;l<r;l++)i.push(0,l+1,l+2);var v=new y.default(e);return v.geometry=new m.default({vertices:o,uvs:u,normals:a,indices:{default:i},facing:m.default.FACING.BOTH}),v}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var R=r(28),w=r(35),O=r(16);t.default=function(e,t,r,n){void 0===r&&(r=16),void 0===n&&(n=12);for(var i=2*Math.PI,o=Math.PI,a=[],u=[],s=[],f=[],l=[],c=0,d=0;d<=n;d++){for(var h=[],p=d/n,v=0;v<=r;v++){var g=v/r,m=-t*Math.cos(0+g*i)*Math.sin(0+p*o),y=t*Math.cos(0+p*o),_=t*Math.sin(0+g*i)*Math.sin(0+p*o);u.push(m,y,_);var T=O.default.normalize(O.default.create(),O.default.fromValues(m,y,_));s.push(T[0],T[1],T[2]),f.push(g,p),h.push(c++)}l.push(h)}for(d=0;d<n;d++)for(v=0;v<r;v++){var E=l[d][v+1],b=l[d][v],x=l[d+1][v],M=l[d+1][v+1];0!==d&&a.push(E,b,M),(d!==n-1||o<Math.PI)&&a.push(b,x,M)}var P=new w.default(e);return P.geometry=new R.default({vertices:u,uvs:f,normals:s,indices:{default:a}}),P}},function(e,t,r){"use strict";var n=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},u=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(n(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var l=r(28),s=r(47),f=r(46),c=r(35),d=r(64);t.createLineFromPath=function(e,t,r){var n=d.default.parseToLine(t,r),i=n.vertices,o=n.indices,a=new f.default(e);return a.geometry=new s.default({vertices:u(i),indices:{default:u(o)}}),a},t.createMeshFromPath=function(e,t,r,n){var i=d.default.parseToGeometry(t,r,n),o=i.vertices,a=i.indices,u=i.uvs,s=i.normals,f=new c.default(e);return f.geometry=new l.default({vertices:o,normals:s,uvs:u,indices:{default:a},facing:l.default.FACING.BOTH}),f}},function(e,t,r){"use strict";var $=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},ee=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat($(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var x=r(16);function _(e,t,r,n,i,o,a){function u(e,t,r,n){return(a=1-e)*a*t+2*(1-(o=e))*o*r+(i=e)*i*n;var i,o,a}var s=r-e,f=n-t,l=Math.sqrt(s*s+f*f),c=Math.ceil(l/a);c<3&&(c=3);for(var d=[],h=1;h<=c;h++){var p=u(h/c,e,r,i),v=u(h/c,t,n,o);d.push(p,v)}return d}var n={parse:function(e,t){for(var r=(e=e.split("\n").join("")).split(" ").filter(Boolean),i=[],n=[],o=0,a=[],u=null;o<r.length;)switch(r[o++]){case"m":var s=Number(r[o++]),f=Number(r[o++]);a.length&&(y(a),n.push(a),a=[]),i.push(s,f),a.push(i.length/2-1),u=[s,f];break;case"q":for(var l=$(u,2),c=l[0],d=l[1],h=Number(r[o++]),p=Number(r[o++]),v=_(c,d,Number(r[o++]),Number(r[o++]),h,p,t),g=0;g<v.length;g+=2)i.push(v[g],v[g+1]),a.push(i.length/2-1);u=[h,p];break;case"l":s=Number(r[o++]),f=Number(r[o++]);var m=$(u,2);for(c=m[0],d=m[1],v=[s,f],g=0;g<v.length;g+=2)i.push(v[g],v[g+1]),a.push(i.length/2-1);u=[s,f];break;case"z":break;default:throw new Error("parse path failed, unhandled item "+r[o])}function y(e){var t=e.length,r=e[0],n=e[t-1];i[2*r]===i[2*n]&&i[2*r+1]===i[2*n+1]&&2*n+1==i.length-1&&(i.pop(),i.pop(),e[t-1]=r)}return y(a),n.push(a),a=[],{vertices:i,lines:n}},parseToLine:function(e,t){var r=this.parse(e,t),n=r.vertices,i=r.lines,o=[];i.forEach(function(r,e){r.forEach(function(e,t){0!==t&&o.push(r[t-1],e)})});for(var a=[],u=0;u<n.length;u+=2)a.push(n[u],n[u+1],0);return{vertices:a,indices:o}},parseToTriangles:function(e,t){for(var u,s,Z,r=this.parse(e,t),n=r.vertices,i=r.lines,o=i.map(function(e){return ee(e)}),a=(u=[],s=[],i.forEach(function(e){for(var t=0,r=0;r<e.length-1;r++){var n=r+1,i=$(ee(Q(e[r]),Q(e[n])),4),o=i[0],a=i[1];t+=(i[2]-o)*(i[3]+a)}0===u.length&&(Z=t/Math.abs(t)),0<=t*Z?u.push(e):s.push(e)}),{polygons:u,holes:s}),_=a.polygons,T=a.holes,f=function(e,t,r){if(0<t.length){var n=function e(t,r){if(0===r.length)return{polygons:t,holes:T};for(var n=0;n<r.length;n++)for(var i=r[n],o=0;o<i.length;o++){for(var a=i[o],u=$(Q(a),2),s=u[0],f=u[1],l=0;l<t.length;l++)for(var c=t[l],d=0;d<c.length;d++){var h=c[d],p=$(Q(h),2),v=p[0],g=p[1];if(m(s,f,v,g))return t.splice(l,1),r.splice(n,1),i.pop(),(i=i.splice(o).concat(i)).push(a),c.splice.apply(c,ee([d+1,0],i,[h])),t.push(c),e(t,r)}throw new Error("can not find visible point pair")}function m(e,t,r,n){for(var i=ee(_,T),o=0;o<i.length;o++)for(var a=i[o],u=0;u<a.length-1;u++){var s=$([a[u],a[u+1]],2),f=s[0],l=s[1],c=$(ee(Q(f),Q(l)),4),d=c[0],h=c[1],p=c[2],v=c[3];if(y(e,t,r,n,d,h,p,v))return!1}return!0}function y(e,t,r,n,i,o,a,u){var s=J(e,t,i,o,a,u),f=J(r,n,i,o,a,u),l=J(i,o,e,t,r,n),c=J(a,u,e,t,r,n);return!isNaN(s*f*l*c)&&(s*f<0&&l*c<0)}return{polygons:_,holes:[]}}(e,t);e=n.polygons,t=n.holes}return e.forEach(function(e){r.push.apply(r,ee(function e(t){if(t.length<3)throw new Error("not valid polygon");if(3===t.length){if(t[0]===t[2])return[];throw new Error("invalid polygon")}for(var r=1;r<t.length-1;r++){var n=$([0===r?t.length-1:r-1,r,r===t.length-1?0:r+1],3),i=n[0],o=n[1],a=n[2],u=$([t[i],t[o],t[a]],3),s=u[0],f=u[1],l=u[2];if(p(i,o,a,t))return t.splice(r,1),ee([s,f,l],e(t))}throw new Error("hole not cleaned")}(e)))}),r}(_,T,[]),l=[],c=[],d=[],h=0;h<n.length;h+=2)l.push(n[h],n[h+1],0),c.push(0,0,1),d.push(0,0);return{vertices:l,indices:f,normals:c,uvs:d,lines:o};function Q(e){return[n[2*e],n[2*e+1]]}function J(e,t,r,n,i,o){var a=(e-i)*(n-o)-(r-i)*(t-o);return 0===a?(e-r)*(e-i)<=0&&(t-n)*(t-o)<=0?0:NaN:0<a?1:-1}function p(e,t,r,n){var i,o,a,u,s,f,l,c,d,h,p,v,g,m,y,_,T,E,b,x,M,P,R,w,O=$([n[e],n[t],n[r]],3),C=O[0],S=O[1],A=O[2],L=$(ee(Q(C),Q(S),Q(A)),6),U=L[0],N=L[1],V=L[2],I=L[3],B=L[4],F=L[5];if(!(J(B,F,U,N,V,I)*Z<=0))return!1;for(var D=0;D<n.length;D++){var G=n[D];if(G!==C&&G!==S&&G!==A){var X=$(Q(G),2),j=X[0],H=X[1];if(x=B,M=F,void 0,P=J(m=j,y=H,_=U,T=N,E=V,b=I),R=J(m,y,E,b,x,M),w=J(m,y,x,M,_,T),!isNaN(P*R*w)&&(P*R*w==0||P===R&&P===w))return!1}if(D!==n.length-1){var z=n[D+1],k=$(ee(Q(G),Q(z)),4),Y=k[0],W=k[1],q=k[2],K=k[3];if(a=B,u=F,void 0,d=J(i=U,o=N,s=Y,f=W,l=q,c=K),h=J(a,u,s,f,l,c),p=J(s,f,i,o,a,u),v=J(l,c,i,o,a,u),g=d*h*p*v,!isNaN(g)&&0!==g&&d*h==-1&&p*v==-1)return!1}}return!0}},parseToGeometry:function(e,r,t){void 0===r&&(r=100),void 0===t&&(t=10);var n=this.parseToTriangles(e,t),g=n.vertices,i=n.indices,o=n.lines,a=[],u=[],s=[],f=[];g.forEach(function(e,t){t%3==2&&(g[t]=r/2,a.push(0,0,1),u.push(0,0),s.push(0,0,-1),f.push(0,0))});var m=g.map(function(e,t){return t%3==2?-r/2:e}),l=ee(i),y=[],_=[],T=[],E=[];return o.forEach(function(e){for(var t=0;t<e.length-1;t++){var r=t+1,n=$([b(g,e[t]),b(g,e[r]),b(m,e[t]),b(m,e[r])],4),i=n[0],o=n[1],a=n[2],u=n[3],s=(c=i,d=o,h=u,void 0,p=x.default.subtract(x.default.create(),c,d),v=x.default.subtract(x.default.create(),d,h),x.default.cross(x.default.create(),p,v)),f=[s[0],s[1],s[2]],l=y.length/3;y.push.apply(y,ee(i,o,a,u)),T.push.apply(T,ee(f,f,f,f)),E.push(0,0,0,0,0,0,0,0),_.push(l,l+1,l+2,l+1,l+2,l+3)}var c,d,h,p,v}),function(r,n,i,o){if(r.length!==n.length)throw new Error("merge vertices not valid");for(var a=[],u=[],s=[],f=[],e=function(e){var t=a.length/3;a=a.concat(r[e]),u=u.concat(n[e].map(function(e){return e+t})),s=s.concat.apply(s,ee(i[e])),f=s.concat.apply(s,ee(o[e]))},t=0;t<r.length;t++)e(t);return{vertices:a,indices:u,normals:s,uvs:f}}([g,m,y],[i,l,_],[a,s,T],[u,f,E]);function b(e,t){return[e[3*t],e[3*t+1],e[3*t+2]]}}};t.default=n},function(e,t,r){"use strict";var n=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},l=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(n(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var i=r(4),c=r(14),m=r(15),y=r(16),_=r(66),T=r(30),E=r(31),b=r(32),x=r(33),M=r(35),P=r(28),R=r(52),w=r(42);t.default=function(d,h,u){i.default.gl;var a,o,p=(a=new Map,function(e,t){void 0===t&&(t=!1);var r=h.bufferViews[e],n=h.buffers[r.buffer].data,i=e+"_"+t.toString();if(!a.get(i))if(t){var o=new b.default({data:n.slice(r.byteOffset,r.byteOffset+r.byteLength)});a.set(i,o)}else o=new T.default({data:n.slice(r.byteOffset,r.byteOffset+r.byteLength)}),a.set(i,o);return a.get(i)}),s=(o=new Map,function(e,t){void 0===t&&(t=!1);var r=e+"_"+(!!t).toString();if(!o.get(r)){var n=h.images[h.textures[e].source].data,i=new w.default({image:n,sRGB:t,flipY:!1});o.set(r,i)}return o.get(r)}),v=new Map,g=h.materials.map(function(e){var t=new R.default,r={},n=e.pbrMetallicRoughness,i=e.normalTexture,o=e.emissiveTexture,a=e.occlusionTexture;return n.baseColorFactor?t.albedoColor={r:255*n.baseColorFactor[0],g:255*n.baseColorFactor[1],b:255*n.baseColorFactor[2]}:t.albedoColor={r:255,g:255,b:255},n.baseColorTexture&&(t.albedoTexture=s(n.baseColorTexture.index,!0),r.gltfAlbedoTexCoord=n.baseColorTexture.texCoord||0),n.metallicRoughnessTexture&&(t.metallicRoughnessTexture=s(n.metallicRoughnessTexture.index,!1),r.gltfMetallicRoughnessTexCoord=n.metallicRoughnessTexture.texCoord||0),"number"==typeof n.metallicFactor?t.metallic=n.metallicFactor:t.metallic=1,"number"==typeof n.roughnessFactor?t.roughness=n.roughnessFactor:t.roughness=1,o&&(t.emissiveTexture=s(o.index,!0),r.gltfEmissiveTexCoord=o.texCoord||0),a&&(t.occlusionTexture=s(a.index,!1),t.occlusionStrength="number"==typeof a.strength?a.strength:1,r.gltfOcclusionTexCoord=a.texCoord||0),i&&(t.normalTexture=s(i.index,!1),r.gltfNormalTexCoord=i.texCoord||0),u&&(t.pbrEnviroment=u),v.set(t,r),t}),f=function(e){var t,r,n,i=new M.default(d),o=h.meshes[e].primitives[0],a=o.attributes,u=o.indices,s=(o.mode,o.material),f=g[s],l={};function c(e){var t=h.accessors[e],r=p(t.bufferView,!1);return new E.default({buffer:r,byteStride:t.byteStride||0,byteOffset:t.byteOffset||0})}return f.albedoTexture&&(l.aAlbedoUV=c(a["TEXCOORD_"+v.get(f).gltfAlbedoTexCoord])),f.metallicRoughnessTexture&&(l.aMetallicRoughnessUV=c(a["TEXCOORD_"+v.get(f).gltfMetallicRoughnessTexCoord])),f.normalTexture&&(l.aNormalUV=c(a["TEXCOORD_"+v.get(f).gltfNormalTexCoord])),f.occlusionTexture&&(l.aOcclusionUV=c(a["TEXCOORD_"+v.get(f).gltfOcclusionTexCoord])),f.emissiveTexture&&(l.aEmissiveUV=c(a["TEXCOORD_"+v.get(f).gltfEmissiveTexCoord])),i.geometry=new P.default({vertices:c(a.POSITION),normals:c(a.NORMAL),uvs:l,indices:{default:(t=u,r=h.accessors[t],n=p(r.bufferView,!0),new x.default({buffer:n,byteOffset:r.byteOffset||0,count:r.count,mode:"TRIANGLES",type:"UNSIGNED_SHORT"}))}}),i.materials.default=f,i},r=h.nodes.map(function(e,t){var r=void 0!==e.mesh?f(e.mesh):new M.default(d);if(e.matrix){var n=c.default.fromValues.apply(c.default,l(e.matrix)),i=c.default.getTranslation(y.default.create(),n),o=c.default.getRotation(m.default.create(),n),a=m.default.getEuler(y.default.create(),o),u=c.default.getScaling(y.default.create(),n);r.position={x:i[0],y:i[1],z:i[2]},r.rotation={x:a[0],y:a[1],z:a[2]},r.scale={x:u[0],y:u[1],z:u[2]}}else e.translation&&(i=e.translation,r.position={x:i[0],y:i[1],z:i[2]}),e.rotation&&(o=_.default.fromValues.apply(_.default,l(e.rotation)),a=m.default.getEuler(y.default.create(),o),r.rotation={x:a[0],y:a[1],z:a[2]}),e.scale&&(u=e.scale,r.scale={x:u[0],y:u[1],z:u[2]});return r});return h.nodes.forEach(function(e,t){e.children&&e.children.forEach(function(e){r[e].parent=r[t]})}),r.filter(function(e){return!e.parent})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={create:function(){var e=new Float32Array(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},fromValues:function(e,t,r,n){var i=new Float32Array(4);return i[0]=e,i[1]=t,i[2]=r,i[3]=n,i},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},set:function(e,t,r,n,i){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e}};t.default=n},function(e,t,r){"use strict";var n=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},i=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(n(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var l=r(28),c=r(35),d=r(36),h=r(42),p=r(68);function v(e){var t=[];return e.forEach(function(e){return t.push.apply(t,i(e))}),t}t.default=function(e,t){var r=v((t=p.default.parse(t)).positions),n=v(t.uvs),i=v(t.normals),o={},a={};for(var u in t.indices){var s=t.mtls[u];s?(o[u]=t.indices[u],a[u]||(a[u]=new d.default),s.ambientColor&&(a[u].ambientColor={r:255*s.ambientColor[0],g:255*s.ambientColor[1],b:255*s.ambientColor[2]}),s.ambientTexture&&(a[u].ambientTexture=new h.default({image:s.ambientTexture})),s.diffuseColor&&(a[u].diffuseColor={r:255*s.diffuseColor[0],g:255*s.diffuseColor[1],b:255*s.diffuseColor[2]}),s.diffuseTexture&&(a[u].diffuseTexture=new h.default({image:s.diffuseTexture,flipY:!0})),s.specularColor&&(a[u].specularColor={r:255*s.specularColor[0],g:255*s.specularColor[1],b:255*s.specularColor[2]}),s.specularTexture&&(a[u].specularTexture=new h.default({image:s.specularTexture}))):o.default=t.indices[u]}var f=new c.default(e);return f.geometry=new l.default({vertices:r,normals:i,uvs:n,indices:o}),f.materials=a,f}},function(e,t,r){"use strict";var E=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a};Object.defineProperty(t,"__esModule",{value:!0});var b=r(16),l=/v( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,c=/vn( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,d=/vt( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,h=/f\s+((([\d]{1,}\/[\d]{1,}[\s]?){3,})+)/,p=/f\s+((([\d]{1,}\/[\d]{1,}\/[\d]{1,}[\s]?){3,})+)/,v=/^usemtl /,g=/^mtllib /,x=/^g/,n={parse:function(e){var y=[],_=[],o=[],i=[],a={positions:[],uvs:[],normals:[],indices:{},mtls:e.mtl?this.parseMtl(e.mtl,e.images):{}},u=0,s=null;return e.obj.split("\n").forEach(function(e){var t,r,n,m;if(0!==(e=e.trim()).length&&"#"!==e.charAt(0))if(null!==(t=l.exec(e)))y.push(t.splice(1).map(Number));else if(null!==(t=c.exec(e)))_.push(t.splice(1).map(Number));else if(null!==(t=d.exec(e)))o.push(t.splice(1).map(Number));else if(null!==(t=p.exec(e)))f(t[1].trim().split(" ")).forEach(function(e){var t=E(e.split("/").map(function(e){return Number(e)-1}),3),r=t[0],n=t[1],i=t[2];T(r,n,i)});else if(null!==(t=h.exec(e)))r=t[1].trim().split(" "),n=f(r),m=0,n.forEach(function(e,t,r){var n=E(e.split("/").map(function(e){return Number(e)-1}),2),i=n[0],o=n[1];if(t%3==0){var a=b.default.fromValues(y[i][0],y[i][1],y[i][2]),u=E(r[t+1].split("/").map(function(e){return Number(e)-1}),1),s=u[0],f=b.default.fromValues(y[s][0],y[s][1],y[s][2]),l=E(r[t+2].split("/").map(function(e){return Number(e)-1}),1),c=l[0],d=b.default.fromValues(y[c][0],y[c][1],y[c][2]),h=b.default.subtract(b.default.create(),f,a),p=b.default.subtract(b.default.create(),d,a),v=b.default.cross(b.default.create(),h,p);_.push(v),m=_.length-1}var g=m;T(i,o,g)});else if(v.test(e)){var i=e.substring(7).trim();a.indices[i]||(a.indices[i]=[]),s=i}else if(g.test(e))i=e.substring(7).trim();else if(x.test(e))e.substring(2).trim()}),a;function T(e,t,r){if(i[e]){var n=function(e,t,r,n){for(var i=e.map(function(e,t){return{value:e,i:t}}).filter(function(e){return e.value===t}).map(function(e){return e.i}),o=0;o<i.length;o++)if(r[i[o]]===n)return i[o];return-1}(i[e].uvs,t,i[e].normals,r);-1!==n?a.indices[s].push(i[e].pos[n]):(i[e].uvs.push(t),i[e].normals.push(r),i[e].pos.push(u),a.positions.push(y[e]),a.uvs.push(o[t]),a.normals.push(_[r]),a.indices[s].push(u++))}else i[e]={uvs:[t],normals:[r],pos:[u]},a.positions.push(y[e]),a.uvs.push(o[t]),a.normals.push(_[r]),a.indices[s].push(u++)}function f(e,t){void 0===t&&(t=[]);for(var r=1;r+1<e.length;)t.push(e[0],e[r],e[r+1]),r++;return t}},parseMtl:function(e,i){var t=e.split("\n"),o={},a=null;return t.forEach(function(e){if(0!==(e=e.trim()).length&&"#"!==e.charAt(0)){var t=e.indexOf(" "),r=(0<=t?e.substring(0,t):e).toLowerCase(),n=0<=t?e.substring(t+1).trim():"";"newmtl"===r?(o[n]={},a=n):"kd"===r?o[a].diffuseColor=n.split(" ").map(Number):"ka"===r?o[a].ambientColor=n.split(" ").map(Number):"ks"===r?o[a].specularColor=n.split(" ").map(Number):"map_kd"===r?o[a].diffuseTexture=i[n]:"map_ka"===r?o[a].ambientTexture=i[n]:"map_ks"===r?o[a].specularTexture=i[n]:"ns"===r&&(o[a].glossiness=Number(n))}}),o}};t.default=n},function(e,t,r){"use strict";var a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var u=r(28),s=r(35),f=r(70);t.default=function(e,t,r){var n=(void 0===r?{}:r).geometry,i=void 0===n?{}:n;t=f.default.parse(t);var o=new s.default(e);return o.geometry=new u.default(a({vertices:t.positions,uvs:t.uvs,normals:t.normals,indices:{default:t.indices}},i)),o}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={parse:function(e){return e instanceof ArrayBuffer?this.parseBinary(e):this.parseASCII(e)},parseBinary:function(e){for(var t=new DataView(e),r=t.getUint32(80,!0),n=[],i=[],o=[],a=[],u=0;u<r;u++)for(var s=84+50*u,f=t.getFloat32(s,!0),l=t.getFloat32(s+4,!0),c=t.getFloat32(s+8,!0),d=1;d<=3;d++){var h=s+12*d;n.push(t.getFloat32(h,!0)),n.push(t.getFloat32(h+4,!0)),n.push(t.getFloat32(h+8,!0)),i.push(f,l,c),o.push(0,0),a.push(a.length)}return{positions:n,normals:i,uvs:o,indices:a}},parseASCII:function(e){for(var t,r=/facet([\s\S]*?)endfacet/g,n=/[\s]+([+-]?(?:\d+.\d+|\d+.|\d+|.\d+)(?:[eE][+-]?\d+)?)/.source,i=new RegExp("vertex"+n+n+n,"g"),o=new RegExp("normal"+n+n+n,"g"),a=[],u=[],s=[],f=[],l={x:0,y:0,z:0};null!==(t=r.exec(e));){for(var c=0,d=0,h=t[0];null!==(t=o.exec(h));)l.x=parseFloat(t[1]),l.y=parseFloat(t[2]),l.z=parseFloat(t[3]),d++;for(;null!==(t=i.exec(h));)a.push(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])),u.push(l.x,l.y,l.z),s.push(0,0),f.push(f.length),c++;if(1!==d)throw new Error("normalCountPerFace is not 1");if(3!==c)throw new Error("vertexCountPerFace is not 3");0}return{positions:a,normals:u,uvs:s,indices:f}}};t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={create:function(){var e=new Float32Array(2);return e[0]=0,e[1]=0,e},fromValues:function(e,t){var r=new Float32Array(2);return r[0]=e,r[1]=t,r},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e},set:function(e,t,r){return e[0]=t,e[1]=r,e}};t.default=n}]).default});
